import{_ as x,n as U,o as V,b2 as S,a as e,w as i,f as n,ax as b,b3 as B,N as v,J as s,aw as u,af as h,e as m,ah as C,c as T,M as g,L as A,Q as D}from"./index.ef228992.js";import{Q as c}from"./QInput.a2bee355.js";import{b as N,Q as k,a as f}from"./QTable.54a77e6e.js";import{c as I,a as y,b as P,Q as E}from"./QPageSticky.a179ccb3.js";import{Q as _}from"./QCardActions.bed2bb53.js";import{Q as z}from"./QPage.2fc420a1.js";import{T as R}from"./TouchPan.9047fff0.js";import{C as L}from"./ClosePopup.6197016b.js";import{api as w}from"./axios.23aa70c0.js";import{e as Y}from"./export-file.dc78ba05.js";import{u as j}from"./use-quasar.38626e8f.js";import{a as q}from"./authenticate.bcdfbf4f.js";import{h as G}from"./moment.9709ab41.js";import"./use-key-composition.25c6204a.js";import"./format.6bd9982d.js";import"./QItemLabel.1cc16253.js";import"./js.cookie.f93afda9.js";function F(o,l,p){let a=l!==void 0?l(o,p):o;return a=a==null?"":String(a),a=a.split('"').join('""'),`"${a}"`}const M=j(),O={name:"CargoPage",data(){return{gasto:{Nombre:"",NCF:"",factura:"",RNC:"",direccion:""},proyectos:[],proyecto:{id:"",cliente:"",fecha_inicio:""},findProy:!1,columsproyecto:[{label:"Nombre",name:"name",required:!0,align:"lefth",field:o=>o.name,format:o=>`${o}`,sortable:!0},{label:"Cliente",name:"cliente",required:!0,align:"lefth",field:o=>o.cliente.nombre,format:o=>`${o}`,sortable:!0},{label:"Fecha Inicio",name:"fecha_inicio",required:!0,align:"center",field:o=>o.fecha_inicio,format:o=>`${o}`,sortable:!0}],items:[],columsitems:[{label:"Cantidad",name:"cantidad",required:!0,align:"center",field:o=>o.cantidad,format:o=>`${o}`,sortable:!0},{label:"Descripcion",name:"descripcion",required:!0,align:"center",field:o=>o.descripcion,format:o=>`${o}`,sortable:!0},{label:"ITBIS",name:"importeimpuesto",required:!0,align:"center",field:o=>o.importeimpuesto,format:o=>`${o}`,sortable:!0},{label:"Importe",name:"importe",required:!0,align:"center",field:o=>o.importe,format:o=>`${o}`,sortable:!0},{label:"Total",name:"valortotal",required:!0,align:"center",field:o=>o.valortotal,format:o=>`${o}`,sortable:!0}],newProducto:!1,nuevoProducto:{cantidad:0,descripcion:"",importeimpuesto:0,importe:0,valortotal:0},confirmarEliminar:!1}},components:{},methods:{AbrirNuevoProducto(){this.newProducto=!0},FormatoFecha(o){return G(String(o)).format("MM/DD/YYYY hh:mm")},loadProyecto(){w.get("proyecto/aprobados/conduce/",{headers:{Authorization:`Bearer ${q.getUserLogged()}`}}).then(o=>{this.proyectos=o.data}).catch(o=>this.$q.notify({type:"negative",position:"top",message:o.response.data.message}))},OpenProyectos(){this.limpiarProducto(),this.findProy=!0},selectProyecto(o){this.proyecto.id=o.id,this.proyecto.name=o.name,this.proyecto.cliente=o.cliente.nombre,this.proyecto.fecha_inicio=o.fecha_inicio,this.findProy=!1},exportTable(){const o=[this.columns.map(p=>F(p.label))].concat(this.rows.map(p=>this.columns.map(a=>F(typeof a.field=="function"?a.field(p):p[a.field===void 0?a.name:a.field],a.format,p)).join(","))).join(`\r
`);Y("table-export.csv",o,"text/csv")!==!0&&M.notify({message:"Browser denied file download...",color:"negative",icon:"warning"})},sumar(){this.nuevoProducto.valortotal=(parseFloat(this.nuevoProducto.importeimpuesto)+parseFloat(this.nuevoProducto.importe)).toFixed(2)},AddProducto(){parseFloat(this.nuevoProducto.cantidad.toString())>0&parseFloat(this.nuevoProducto.importeimpuesto.toString())>0?(this.items.push({cantidad:this.nuevoProducto.cantidad,descripcion:this.nuevoProducto.descripcion,importeimpuesto:this.nuevoProducto.importeimpuesto,importe:this.nuevoProducto.importe,valortotal:this.nuevoProducto.valortotal}),this.ClosedNewProducto()):this.$q.notify({color:"negative",position:"top",message:"La Cantidad y el importe no pueden ser 0",icon:"warning"})},ClosedNewProducto(){this.limpiarProducto(),this.newProducto=!1},limpiarProducto(){this.nuevoProducto.cantidad=0,this.nuevoProducto.descripcion="",this.nuevoProducto.importeimpuesto=0,this.nuevoProducto.importe=0,this.nuevoProducto.valortotal=0},selectProducto(o){this.nuevoProducto.cantidad=o.cantidad,this.nuevoProducto.descripcion=o.descripcion,this.nuevoProducto.importeimpuesto=o.importeimpuesto,this.nuevoProducto.importe=o.importe,this.nuevoProducto.valortotal=o.valortotal,this.confirmarEliminar=!0},Cancelar(){this.items.forEach((o,l)=>{o.descripcion===this.nuevoProducto.descripcion&&this.items.splice(l,1)}),this.confirmarEliminar=!1,this.limpiarProducto()},async savedGasto(){this.gasto.Nombre===""||this.items.length===0?this.$q.notify({type:"negative",position:"top",message:"Debe seleccionar un proyecto y al menos tener un servicio"}):await w.post("/gastos-empresas",{Nombre:this.gasto.Nombre,NCF:this.gasto.NCF,factura:this.gasto.factura,RNC:this.gasto.RNC,direccion:this.gasto.direccion,idproyecto:this.proyecto.id,items:this.items},{headers:{Authorization:`Bearer ${q.getUserLogged()}`}}).then(o=>{this.$q.notify({color:"positive",position:"top",message:"Se inserto el gasto "+o.data.Nombre,icon:"done"}),this.$router.push("/gastos")}).catch(o=>this.$q.notify({type:"negative",position:"top",message:o.response.data.message}))}},mounted(){this.loadProyecto()},setup(){return{filter:U("")}}},K={class:"q-pa-md flat bordered"},J=n("div",{class:"text-h6"},"Proyecto",-1),H={class:"q-pa-md q-gutter-sm"},W=n("div",{class:"text-h6"},"Nuevo producto",-1),X={class:"q-pa-md"},Z={class:"q-pa-md"},$={class:"q-pa-md q-gutter-sm"},ee={class:"q-ml-sm"};function oe(o,l,p,a,r,d){return V(),S(B,null,[e(z,{class:"q-pa-md"},{default:i(()=>[n("div",K,[e(v,{class:"my-card"},{default:i(()=>[e(s,{class:"row items-center q-pb-none"},{default:i(()=>[J]),_:1}),e(s,null,{default:i(()=>[n("p",null," Nombre: "+u(r.proyecto.name),1),n("p",null," Cliente: "+u(r.proyecto.cliente),1),n("p",null," Fecha Inicio: "+u(d.FormatoFecha(r.proyecto.fecha_inicio)),1)]),_:1}),e(h),e(s,null,{default:i(()=>[e(c,{filled:"",modelValue:r.gasto.Nombre,"onUpdate:modelValue":l[0]||(l[0]=t=>r.gasto.Nombre=t),label:"Nombre Entidad","input-class":"text-lefth"},null,8,["modelValue"])]),_:1}),e(s,null,{default:i(()=>[e(c,{filled:"",modelValue:r.gasto.NCF,"onUpdate:modelValue":l[1]||(l[1]=t=>r.gasto.NCF=t),label:"NCF","input-class":"text-lefth"},null,8,["modelValue"])]),_:1}),e(s,null,{default:i(()=>[e(c,{filled:"",modelValue:r.gasto.factura,"onUpdate:modelValue":l[2]||(l[2]=t=>r.gasto.factura=t),label:"No. Factura","input-class":"text-lefth"},null,8,["modelValue"])]),_:1}),e(s,null,{default:i(()=>[e(c,{filled:"",modelValue:r.gasto.RNC,"onUpdate:modelValue":l[3]||(l[3]=t=>r.gasto.RNC=t),label:"RNC","input-class":"text-lefth"},null,8,["modelValue"])]),_:1}),e(s,null,{default:i(()=>[e(c,{filled:"",modelValue:r.gasto.direccion,"onUpdate:modelValue":l[4]||(l[4]=t=>r.gasto.direccion=t),label:"Direccion","input-class":"text-lefth"},null,8,["modelValue"])]),_:1}),e(h),e(s,null,{default:i(()=>[e(N,{flat:"",bordered:"",title:"Productos",rows:r.items,columns:r.columsitems,color:"primary","row-key":"name",filter:a.filter},{body:i(t=>[e(k,{props:t,onClick:Q=>d.selectProducto(t.row)},{default:i(()=>[e(f,{key:"cantidad",props:t},{default:i(()=>[m(u(t.row.cantidad),1)]),_:2},1032,["props"]),e(f,{key:"descripcion",props:t},{default:i(()=>[m(u(t.row.descripcion),1)]),_:2},1032,["props"]),e(f,{key:"importeimpuesto",props:t},{default:i(()=>[m(u(t.row.importeimpuesto),1)]),_:2},1032,["props"]),e(f,{key:"importe",props:t},{default:i(()=>[m(u(t.row.importe),1)]),_:2},1032,["props"]),e(f,{key:"valortotal",props:t},{default:i(()=>[m(u(t.row.valortotal),1)]),_:2},1032,["props"])]),_:2},1032,["props","onClick"])]),_:1},8,["rows","columns","filter"])]),_:1})]),_:1})]),e(I,{position:"top-right",offset:[18,18]},{default:i(()=>[C((V(),T(E,{icon:"add",direction:"down",color:"primary",disable:o.draggingFab},{default:i(()=>[e(y,{onClick:l[5]||(l[5]=t=>d.savedGasto()),color:"positive",icon:"save",disable:o.draggingFab},{default:i(()=>[e(P,null,{default:i(()=>[m(" Salvar ")]),_:1})]),_:1},8,["disable"]),e(y,{onClick:l[6]||(l[6]=t=>d.AbrirNuevoProducto()),color:"positive",icon:"add_box",disable:o.draggingFab},{default:i(()=>[e(P,null,{default:i(()=>[m(" Nuevo producto ")]),_:1})]),_:1},8,["disable"]),e(y,{onClick:l[7]||(l[7]=t=>d.OpenProyectos()),color:"positive",icon:"search",disable:o.draggingFab},{default:i(()=>[e(P,null,{default:i(()=>[m(" Buscar Proyecto ")]),_:1})]),_:1},8,["disable"])]),_:1},8,["disable"])),[[R,o.moveFab,void 0,{prevent:!0,mouse:!0}]])]),_:1}),n("template",null,[n("div",H,[e(b,{modelValue:r.newProducto,"onUpdate:modelValue":l[17]||(l[17]=t=>r.newProducto=t),persistent:""},{default:i(()=>[e(v,{class:"my-card",flat:"",bordered:""},{default:i(()=>[e(s,null,{default:i(()=>[W]),_:1}),e(h),e(s,{class:"horizontal"},{default:i(()=>[e(c,{filled:"",modelValue:r.nuevoProducto.cantidad,"onUpdate:modelValue":l[8]||(l[8]=t=>r.nuevoProducto.cantidad=t),label:"Cantidad",mask:"#.##","fill-mask":"0","reverse-fill-mask":"","input-class":"text-right"},null,8,["modelValue"])]),_:1}),e(s,{class:"horizontal"},{default:i(()=>[e(c,{modelValue:r.nuevoProducto.descripcion,"onUpdate:modelValue":l[9]||(l[9]=t=>r.nuevoProducto.descripcion=t),filled:"",type:"textarea",label:"Descripcion"},null,8,["modelValue"])]),_:1}),e(s,{class:"horizontal"},{default:i(()=>[e(c,{filled:"",modelValue:r.nuevoProducto.importeimpuesto,"onUpdate:modelValue":l[10]||(l[10]=t=>r.nuevoProducto.importeimpuesto=t),label:"ITBIS *",onKeyup:l[11]||(l[11]=t=>d.sumar()),mask:"#.##","fill-mask":"0","reverse-fill-mask":"",prefix:"$","input-class":"text-right"},null,8,["modelValue"])]),_:1}),e(s,{class:"horizontal"},{default:i(()=>[e(c,{filled:"",modelValue:r.nuevoProducto.importe,"onUpdate:modelValue":l[12]||(l[12]=t=>r.nuevoProducto.importe=t),label:"Importe *",onKeyup:l[13]||(l[13]=t=>d.sumar()),mask:"#.##","fill-mask":"0","reverse-fill-mask":"",prefix:"$","input-class":"text-right"},null,8,["modelValue"])]),_:1}),e(s,{class:"horizontal"},{default:i(()=>[e(c,{filled:"",readonly:!0,disable:!0,modelValue:r.nuevoProducto.valortotal,"onUpdate:modelValue":l[14]||(l[14]=t=>r.nuevoProducto.valortotal=t),label:"Total *",prefix:"$","input-class":"text-right"},null,8,["modelValue"])]),_:1}),e(h),e(s,{class:"horizontal"},{default:i(()=>[e(_,null,{default:i(()=>[e(g,{label:"Enviar",icon:"send",type:"submit",color:"primary",flat:"",class:"q-ml-sm",onClick:l[15]||(l[15]=t=>d.AddProducto())}),e(g,{label:"Cancelar",icon:"cancel",type:"reset",color:"primary",flat:"",class:"q-ml-sm",onClick:l[16]||(l[16]=t=>d.ClosedNewProducto())})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])])])]),_:1}),n("div",X,[e(b,{modelValue:r.findProy,"onUpdate:modelValue":l[19]||(l[19]=t=>r.findProy=t),"full-width":""},{default:i(()=>[e(v,{class:"my-card"},{default:i(()=>[e(s,null,{default:i(()=>[n("div",Z,[e(N,{flat:"",bordered:"",title:"Proyectos",rows:r.proyectos,columns:r.columsproyecto,color:"primary","row-key":"name",filter:a.filter},{body:i(t=>[e(k,{props:t,onClick:Q=>d.selectProyecto(t.row)},{default:i(()=>[e(f,{key:"name",props:t},{default:i(()=>[m(u(t.row.name),1)]),_:2},1032,["props"]),e(f,{key:"cliente",props:t},{default:i(()=>[m(u(t.row.cliente.nombre),1)]),_:2},1032,["props"]),e(f,{key:"fecha_inicio",props:t},{default:i(()=>[m(u(d.FormatoFecha(t.row.fecha_inicio)),1)]),_:2},1032,["props"])]),_:2},1032,["props","onClick"])]),"top-right":i(()=>[e(c,{borderless:"",dense:"",debounce:"300",modelValue:a.filter,"onUpdate:modelValue":l[18]||(l[18]=t=>a.filter=t),placeholder:"Buscar"},{append:i(()=>[e(A,{name:"search"})]),_:1},8,["modelValue"])]),_:1},8,["rows","columns","filter"])])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),n("template",null,[n("div",$,[e(b,{modelValue:r.confirmarEliminar,"onUpdate:modelValue":l[21]||(l[21]=t=>r.confirmarEliminar=t),persistent:""},{default:i(()=>[e(v,null,{default:i(()=>[e(s,{class:"row items-center"},{default:i(()=>[e(D,{icon:"priority_high",color:"primary","text-color":"white"}),n("span",ee,"Desea Quitar el producto?: "+u(r.nuevoProducto.descripcion)+".",1)]),_:1}),e(_,{align:"right"},{default:i(()=>[C(e(g,{label:"NO",icon:"cancel",type:"cancel",color:"secondary",flat:"",class:"q-ml-sm"},null,512),[[L]]),e(g,{label:"Si",icon:"send",type:"submit",color:"primary",flat:"",class:"q-ml-sm",onClick:l[20]||(l[20]=t=>d.Cancelar())})]),_:1})]),_:1})]),_:1},8,["modelValue"])])])],64)}var ye=x(O,[["render",oe]]);export{ye as default};
