import{Q as q,a as p,b as Q}from"./QTable.54a77e6e.js";import{_,o as b,c as g,w as l,a,e as u,aw as n,L as w,f as s,N as f,J as o,af as y,M as d,ax as h,ah as v,Q as V}from"./index.ef228992.js";import{Q as c}from"./QInput.a2bee355.js";import{Q as S}from"./QCardActions.bed2bb53.js";import{Q as k,a as x,b as I,c as T}from"./QPageSticky.a179ccb3.js";import{Q as N}from"./QPage.2fc420a1.js";import{T as U}from"./TouchPan.9047fff0.js";import{C as F}from"./ClosePopup.6197016b.js";import{api as C}from"./axios.23aa70c0.js";import{u as A}from"./use-quasar.38626e8f.js";import{a as P}from"./authenticate.bcdfbf4f.js";import"./format.6bd9982d.js";import"./use-key-composition.25c6204a.js";import"./QItemLabel.1cc16253.js";import"./js.cookie.f93afda9.js";A();const z={name:"PreFacturaPage",data(){return{confirm:!1,savedFactura:{},ConfirmFactura:!1,NewPrefactura:!1,prefacturas:[],prefacturasAux:[],prefacturaSelected:{id:"",cantidad:0,servicio:"",precio:"",importe:0,importeImpuesto:0,importeTotal:0,valorimpuesto:0},columsprefactura:[{label:"Cantidad",name:"cantidad",required:!0,align:"center",field:e=>e.cantidad,format:e=>`${e}`,sortable:!0},{label:"Servicio",name:"nombreServicio",required:!0,align:"center",field:e=>e.nombreServicio,format:e=>`${e}`,sortable:!0},{label:"Precio",name:"precio",required:!0,align:"center",field:e=>e.precio,format:e=>`${e}`,sortable:!0},{label:"Importe",name:"importe",required:!0,align:"center",field:e=>e.importe,format:e=>`${e}`,sortable:!0},{label:"Importe ITBI",name:"importeimpuesto",required:!0,align:"center",field:e=>e.importeimpuesto,format:e=>`${e}`,sortable:!0},{label:"Importe Total",name:"valortotal",required:!0,align:"center",field:e=>e.valortotal,format:e=>`${e}`,sortable:!0}]}},components:{},methods:{async loadPrefactura(){await C.get("/pre-factura/ByIdProyecto/"+this.$route.params.idproyecto,{headers:{Authorization:`Bearer ${P.getUserLogged()}`}}).then(e=>{this.prefacturas=e.data}).catch(e=>this.$q.notify({type:"negative",position:"top",message:e.response.data.message})),this.CrearListaAux()},selectPrefactura(e){this.prefacturaSelected.id=e.id,this.prefacturaSelected.cantidad=e.cantidad,this.prefacturaSelected.servicio=e.nombreServicio,this.prefacturaSelected.precio=e.precio,this.prefacturaSelected.importe=e.importe,this.prefacturaSelected.importeImpuesto=e.importeimpuesto,this.prefacturaSelected.importeTotal=e.valortotal,this.prefacturaSelected.valorimpuesto=e.valorimpuesto,this.NewPrefactura=!0},CrearListaAux(){for(let e=0;e<this.prefacturas.length;e++)this.prefacturasAux.push({id:this.prefacturas[e].id,cantidad:this.prefacturas[e].cantidad})},Modificar(){let e=this.prefacturasAux.find(t=>t.id==this.prefacturaSelected.id).cantidad;parseFloat(e)<parseFloat(this.prefacturaSelected.cantidad)?this.$q.notify({color:"negative",position:"top",message:"La Cantidad introducida es mayor a la disponible: "+this.prefacturasAux.find(t=>t.id==this.prefacturaSelected.id).cantidad,icon:"report_problem"}):(this.prefacturas.find(t=>t.id==this.prefacturaSelected.id).cantidad=parseFloat(this.prefacturaSelected.cantidad).toFixed(2),this.prefacturas.find(t=>t.id==this.prefacturaSelected.id).importe=parseFloat(this.prefacturaSelected.importe).toFixed(2),this.prefacturas.find(t=>t.id==this.prefacturaSelected.id).importeimpuesto=parseFloat(this.prefacturaSelected.importeImpuesto).toFixed(2),this.prefacturas.find(t=>t.id==this.prefacturaSelected.id).valortotal=parseFloat(this.prefacturaSelected.importeTotal).toFixed(2),this.NewPrefactura=!1)},calcular(){this.prefacturaSelected.importe=parseFloat(this.prefacturaSelected.cantidad*this.prefacturaSelected.precio),this.prefacturaSelected.importeImpuesto=parseFloat(this.prefacturaSelected.cantidad*this.prefacturaSelected.precio*this.prefacturaSelected.valorimpuesto),this.prefacturaSelected.importeTotal=parseFloat(this.prefacturaSelected.importe+this.prefacturaSelected.importeImpuesto)},async EnviarFactura(){const e={idProyecto:this.$route.params.idproyecto,prefacturas:this.prefacturas};await C.post("/factura",e,{headers:{Authorization:`Bearer ${P.getUserLogged()}`}}).then(t=>{this.$q.notify({color:"positive",position:"top",message:"Se genero la pre factura",icon:"report_problem"}),this.$router.push({path:"/detailprefactura/"+t.data.id,params:{idfactura:t.data.id}})}).catch(t=>this.$q.notify({type:"negative",position:"top",message:t.response.data.message}))},removeService(){this.confirm=!1,this.prefacturas.forEach((e,t)=>{e.id===this.prefacturaSelected.id&&this.prefacturas.splice(t,1)}),this.NewPrefactura=!1}},mounted(){this.loadPrefactura()},setup(){return{}}},B={class:"q-pa-md q-gutter-sm"},D=s("div",{class:"text-h6"},"Modificar Servicio",-1),L={class:"q-pa-md q-gutter-sm"},E=s("span",{class:"q-ml-sm"},"Desea Crear la Prefactura?.",-1),M={class:"q-pa-md q-gutter-sm"},J=s("span",{class:"q-ml-sm"},"Desea Quitar el servicio de la PreFactura.",-1);function K(e,t,O,j,i,m){return b(),g(N,{class:"q-pa-md"},{default:l(()=>[a(Q,{flat:"",bordered:"",title:"Servicios Disponibles para Prefacturar",rows:i.prefacturas,columns:i.columsprefactura,color:"primary","row-key":"name",filter:e.filter},{body:l(r=>[a(q,{props:r,onClick:G=>m.selectPrefactura(r.row)},{default:l(()=>[a(p,{key:"cantidad",props:r},{default:l(()=>[u(n(r.row.cantidad),1)]),_:2},1032,["props"]),a(p,{key:"nombreServicio",props:r},{default:l(()=>[u(n(r.row.nombreServicio),1)]),_:2},1032,["props"]),a(p,{key:"precio",props:r},{default:l(()=>[u(n(r.row.precio),1)]),_:2},1032,["props"]),a(p,{key:"importe",props:r},{default:l(()=>[u(n(r.row.importe),1)]),_:2},1032,["props"]),a(p,{key:"importeimpuesto",props:r},{default:l(()=>[u(n(r.row.importeimpuesto),1)]),_:2},1032,["props"]),a(p,{key:"valortotal",props:r},{default:l(()=>[u(n(r.row.valortotal),1)]),_:2},1032,["props"])]),_:2},1032,["props","onClick"])]),"top-right":l(()=>[a(c,{borderless:"",dense:"",debounce:"300",modelValue:e.filter,"onUpdate:modelValue":t[0]||(t[0]=r=>e.filter=r),placeholder:"Buscar"},{append:l(()=>[a(w,{name:"search"})]),_:1},8,["modelValue"])]),_:1},8,["rows","columns","filter"]),s("template",null,[s("div",B,[a(h,{modelValue:i.NewPrefactura,"onUpdate:modelValue":t[11]||(t[11]=r=>i.NewPrefactura=r),persistent:""},{default:l(()=>[a(f,{class:"my-card",flat:"",bordered:""},{default:l(()=>[a(o,null,{default:l(()=>[D]),_:1}),a(y),a(o,{class:"horizontal"},{default:l(()=>[a(c,{filled:"",modelValue:i.prefacturaSelected.cantidad,"onUpdate:modelValue":t[1]||(t[1]=r=>i.prefacturaSelected.cantidad=r),label:"Cantidad",onKeyup:t[2]||(t[2]=r=>m.calcular()),"input-class":"text-right"},null,8,["modelValue"])]),_:1}),a(o,{class:"horizontal"},{default:l(()=>[a(c,{filled:"",modelValue:i.prefacturaSelected.servicio,"onUpdate:modelValue":t[3]||(t[3]=r=>i.prefacturaSelected.servicio=r),label:"Servicio ",readonly:!0,disable:!0},null,8,["modelValue"])]),_:1}),a(o,{class:"horizontal"},{default:l(()=>[a(c,{filled:"",modelValue:i.prefacturaSelected.precio,"onUpdate:modelValue":t[4]||(t[4]=r=>i.prefacturaSelected.precio=r),label:"Precio",readonly:!0,disable:!0,"input-class":"text-right"},null,8,["modelValue"])]),_:1}),a(o,{class:"horizontal"},{default:l(()=>[a(c,{filled:"",modelValue:i.prefacturaSelected.importe,"onUpdate:modelValue":t[5]||(t[5]=r=>i.prefacturaSelected.importe=r),label:"Importe",readonly:!0,disable:!0,"input-class":"text-right"},null,8,["modelValue"])]),_:1}),a(o,{class:"horizontal"},{default:l(()=>[a(c,{filled:"",modelValue:i.prefacturaSelected.importeImpuesto,"onUpdate:modelValue":t[6]||(t[6]=r=>i.prefacturaSelected.importeImpuesto=r),label:"Importe Impuesto *",readonly:!0,disable:!0,"input-class":"text-right"},null,8,["modelValue"])]),_:1}),a(o,{class:"horizontal"},{default:l(()=>[a(c,{filled:"",modelValue:i.prefacturaSelected.importeTotal,"onUpdate:modelValue":t[7]||(t[7]=r=>i.prefacturaSelected.importeTotal=r),label:"Importe Total",readonly:!0,disable:!0,"input-class":"text-right"},null,8,["modelValue"])]),_:1}),a(y),a(o,{class:"horizontal"},{default:l(()=>[a(S,null,{default:l(()=>[a(d,{label:"Salvar",icon:"save",type:"submit",color:"primary",flat:"",class:"q-ml-sm",onClick:t[8]||(t[8]=r=>m.Modificar())}),a(d,{label:"Cancelar",icon:"cancel",type:"reset",color:"primary",flat:"",class:"q-ml-sm",onClick:t[9]||(t[9]=r=>i.NewPrefactura=!1)}),a(d,{label:"Eliminar",icon:"delete",type:"reset",color:"negative",flat:"",class:"q-ml-sm",onClick:t[10]||(t[10]=r=>i.confirm=!0)})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])])]),a(T,{position:"top-right",offset:[18,18]},{default:l(()=>[v((b(),g(k,{icon:"add",direction:"down",color:"primary",disable:e.draggingFab},{default:l(()=>[a(x,{onClick:t[12]||(t[12]=r=>i.ConfirmFactura=!0),color:"positive",icon:"check",disable:e.draggingFab},{default:l(()=>[a(I,null,{default:l(()=>[u(" Crear Prefactura ")]),_:1})]),_:1},8,["disable"])]),_:1},8,["disable"])),[[U,e.moveFab,void 0,{prevent:!0,mouse:!0}]])]),_:1}),s("template",null,[s("div",L,[a(h,{modelValue:i.ConfirmFactura,"onUpdate:modelValue":t[14]||(t[14]=r=>i.ConfirmFactura=r),persistent:""},{default:l(()=>[a(f,null,{default:l(()=>[a(o,{class:"row items-center"},{default:l(()=>[a(V,{icon:"priority_high",color:"primary","text-color":"white"}),E]),_:1}),a(S,{align:"right"},{default:l(()=>[v(a(d,{label:"NO",icon:"cancel",type:"cancel",color:"secondary",flat:"",class:"q-ml-sm"},null,512),[[F]]),a(d,{label:"Si",icon:"send",type:"submit",color:"primary",flat:"",class:"q-ml-sm",onClick:t[13]||(t[13]=r=>m.EnviarFactura())})]),_:1})]),_:1})]),_:1},8,["modelValue"])])]),s("template",null,[s("div",M,[a(h,{modelValue:i.confirm,"onUpdate:modelValue":t[16]||(t[16]=r=>i.confirm=r),persistent:""},{default:l(()=>[a(f,null,{default:l(()=>[a(o,{class:"row items-center"},{default:l(()=>[a(V,{icon:"priority_high",color:"primary","text-color":"white"}),J]),_:1}),a(S,{align:"right"},{default:l(()=>[v(a(d,{label:"Cancelar",icon:"cancel",type:"cancel",color:"primary",flat:"",class:"q-ml-sm"},null,512),[[F]]),a(d,{label:"Eliminar",icon:"delete",type:"submit",color:"negative",flat:"",class:"q-ml-sm",onClick:t[15]||(t[15]=r=>m.removeService())})]),_:1})]),_:1})]),_:1},8,["modelValue"])])])]),_:1})}var ue=_(z,[["render",K]]);export{ue as default};
