import{Q as x,a as y,b as _,g as P}from"./QTable.54a77e6e.js";import{_ as N,n as p,o as C,c as q,w as a,f as u,a as l,e as c,aw as v,N as U,J as r,af as b,L as g,M as f,ax as V,ah as Q,Q as A}from"./index.ef228992.js";import{Q as n}from"./QInput.a2bee355.js";import{Q as E}from"./QCardActions.bed2bb53.js";import{Q as D,a as k,b as z,c as S}from"./QPageSticky.a179ccb3.js";import{Q as B}from"./QPage.2fc420a1.js";import{T as L}from"./TouchPan.9047fff0.js";import{C as T}from"./ClosePopup.6197016b.js";import{api as h}from"./axios.23aa70c0.js";import{e as j}from"./export-file.dc78ba05.js";import{u as O}from"./use-quasar.38626e8f.js";import{a as w}from"./authenticate.bcdfbf4f.js";import"./format.6bd9982d.js";import"./use-key-composition.25c6204a.js";import"./QItemLabel.1cc16253.js";import"./js.cookie.f93afda9.js";function R(o,s,d){let i=s!==void 0?s(o,d):o;return i=i==null?"":String(i),i=i.split('"').join('""'),`"${i}"`}const F=O(),I={name:"UsuarioPage",data(){return{newUser:!1,editUser:!1,password:"",repeatPassword:"",passwordEdit:"",repeatPasswordEdit:"",rows:[],columns:[{label:"Usuario",name:"username",required:!0,align:"center",field:o=>o.username,format:o=>`${o}`,sortable:!0},{name:"name",align:"center",label:"Nombre",field:o=>o.details.name,sortable:!0},{name:"status",align:"center",label:"Estado",field:o=>o.status,sortable:!0}],usuarios:[],usuario:{username:"",name:"",lastname:"",email:"",password:"",roles:[],ideselected:0},roles:[]}},components:{},methods:{loadusers(){h.get("/users/",{headers:{Authorization:`Bearer ${w.getUserLogged()}`}}).then(o=>{this.rows=o.data}).catch(o=>this.$q.notify({type:"negative",position:"top",message:o.response.data.message}))},loadroles(){h.get("/role/",{headers:{Authorization:`Bearer ${w.getUserLogged()}`}}).then(o=>{this.roles=o.data}).catch(o=>this.$q.notify({type:"negative",position:"top",message:o.response.data.message}))},OpenNewUsuario(){this.password="",this.usuario.email="",this.usuario.lastname="",this.usuario.name="",this.usuario.roles=[],this.usuario.username="",this.newUser=!0},ClosedNewUser(){this.usuario.username="",this.password="",this.usuario.email="",this.usuario.lastname="",this.usuario.name="",this.usuario.roles=[],this.newUser=!1},async AddUser(){this.usuario.username!==""&this.password!==""&this.repeatPassword!==""&this.selectedRoles!==""?this.password!==this.repeatPassword?this.$q.notify({color:"negative",position:"top",message:"Las contrasenas no son iguales",icon:"report_problem"}):(this.usuario.password=this.password,this.usuario.roles=this.selectedRoles,await h.post("/users/",this.usuario,{headers:{Authorization:`Bearer ${w.getUserLogged()}`}}).then(o=>{this.$q.notify({color:"positive",position:"top",message:"Se inserto el usuario "+o.data.username,icon:"done"})}).catch(o=>this.$q.notify({type:"negative",position:"top",message:o.response.data.message})),this.newUser=!1,this.password="",this.loadusers()):this.$q.notify({color:"negative",position:"top",message:"Llene los capos requeridos",icon:"report_problem"})},OpenEdit(){this.editUser=!0},async EditUser(){let o=!1;this.usuario.username!==""&this.usuario.roles.length>0?(this.passwordEdit!==""&this.passwordEdit!==this.repeatPasswordEdit?this.$q.notify({color:"negative",position:"top",message:"Las contrasenas no son iguales",icon:"report_problem"}):this.repeatPasswordEdit!==""&this.passwordEdit===""?this.$q.notify({color:"negative",position:"top",message:"Debe poner las dos contrasena",icon:"report_problem"}):o=!0,o===!0&&(this.usuario.password=this.passwordEdit,await h.patch("/users/"+this.idselected,this.usuario,{headers:{Authorization:`Bearer ${w.getUserLogged()}`}}).then(s=>{this.$q.notify({color:"positive",position:"top",message:"Se Modifico el usuario "+s.data.username,icon:"done"})}).catch(s=>this.$q.notify({type:"negative",position:"top",message:s.response.data.message})),this.editUser=!1,this.usuario.roles=[],this.passwordEdit="",this.loadusers())):this.$q.notify({color:"negative",position:"top",message:"Llene los capos requeridos",icon:"report_problem"})},ClosedEditUser(){this.usuario={},this.editUser=!1},async DeleteUser(){await h.delete("/users/"+this.idselected,{headers:{Authorization:`Bearer ${w.getUserLogged()}`}}).then(o=>{this.$q.notify({color:"positive",position:"top",message:"Se Desahabilito el usuario del sistema "+o.data.username,icon:"done"})}).catch(o=>this.$q.notify({type:"negative",position:"top",message:o.response.data.message})),this.confirm=!1,this.editUser=!1,this.loadusers()},onRowClick(o){this.usuario.username=o.username,this.usuario.name=o.details.name,this.usuario.lastname=o.details.lastname,this.usuario.email=o.details.email,this.usuario.roles=[],this.idselected=o.id;for(let s=0;s<o.roles.length;s++)this.usuario.roles.push(o.roles[s].name);this.editUser=!0},exportTable(){const o=[this.columns.map(d=>R(d.label))].concat(this.rows.map(d=>this.columns.map(i=>R(typeof i.field=="function"?i.field(d):d[i.field===void 0?i.name:i.field],i.format,d)).join(","))).join(`\r
`);j("table-export.csv",o,"text/csv")!==!0&&F.notify({message:"Browser denied file download...",color:"negative",icon:"warning"})}},mounted(){this.loadusers(),this.loadroles()},setup(){return{selected:p([]),selectedRoles:p(null),isPwd:p(!0),isPwdR:p(!0),isPwdE:p(!0),isPwdRE:p(!0),confirm:p(!1)}}},M={class:"q-pa-md"},J={class:"q-pa-md q-gutter-sm"},G=u("div",{class:"text-h6"},"Nuevo Usuario",-1),H={class:"q-pa-md q-gutter-sm"},K=u("div",{class:"text-h6"},"Editar Usuario",-1),W={class:"q-pa-md q-gutter-sm"},X=u("span",{class:"q-ml-sm"},"Desea desahabilitar el usuario?.",-1);function Y(o,s,d,i,t,m){return C(),q(B,{class:"q-pa-md"},{default:a(()=>[u("div",M,[l(_,{flat:"",bordered:"",title:"Usuarios",rows:t.rows,columns:t.columns,color:"primary","row-key":"name"},{body:a(e=>[l(x,{props:e,onClick:Z=>m.onRowClick(e.row)},{default:a(()=>[l(y,{key:"username",props:e},{default:a(()=>[c(v(e.row.username),1)]),_:2},1032,["props"]),l(y,{key:"name",props:e},{default:a(()=>[c(v(e.row.details.name),1)]),_:2},1032,["props"]),l(y,{key:"status",props:e},{default:a(()=>[c(v(e.row.status),1)]),_:2},1032,["props"])]),_:2},1032,["props","onClick"])]),_:1},8,["rows","columns"])]),u("template",null,[u("div",J,[l(V,{modelValue:t.newUser,"onUpdate:modelValue":s[11]||(s[11]=e=>t.newUser=e),persistent:""},{default:a(()=>[l(U,{class:"my-card",flat:"",bordered:""},{default:a(()=>[l(r,{class:"horizontal"},{default:a(()=>[G]),_:1}),l(b),l(r,{class:"horizontal"},{default:a(()=>[l(n,{filled:"",modelValue:t.usuario.username,"onUpdate:modelValue":s[0]||(s[0]=e=>t.usuario.username=e),label:"Usuario *","lazy-rules":"",rules:[e=>e&&e.length>0||"Debe introducir un nombre de usuario"]},null,8,["modelValue","rules"])]),_:1}),l(r,{class:"horizontal"},{default:a(()=>[l(n,{filled:"",modelValue:t.usuario.name,"onUpdate:modelValue":s[1]||(s[1]=e=>t.usuario.name=e),label:"Nombre "},null,8,["modelValue"])]),_:1}),l(r,{class:"horizontal"},{default:a(()=>[l(n,{filled:"",modelValue:t.usuario.lastname,"onUpdate:modelValue":s[2]||(s[2]=e=>t.usuario.lastname=e),label:"Apellidos "},null,8,["modelValue"])]),_:1}),l(r,{class:"horizontal"},{default:a(()=>[l(n,{filled:"",modelValue:t.usuario.email,"onUpdate:modelValue":s[3]||(s[3]=e=>t.usuario.email=e),label:"Email "},null,8,["modelValue"])]),_:1}),l(r,{class:"horizontal"},{default:a(()=>[l(n,{modelValue:t.password,"onUpdate:modelValue":s[5]||(s[5]=e=>t.password=e),filled:"",type:i.isPwd?"password":"text",label:"Contrasena"},{append:a(()=>[l(g,{name:i.isPwd?"visibility_off":"visibility",class:"cursor-pointer",onClick:s[4]||(s[4]=e=>i.isPwd=!i.isPwd)},null,8,["name"])]),_:1},8,["modelValue","type"])]),_:1}),l(r,{class:"horizontal"},{default:a(()=>[l(n,{modelValue:t.repeatPassword,"onUpdate:modelValue":s[7]||(s[7]=e=>t.repeatPassword=e),filled:"",type:i.isPwdR?"password":"text",label:"Repetir Contrasena"},{append:a(()=>[l(g,{name:i.isPwdR?"visibility_off":"visibility",class:"cursor-pointer",onClick:s[6]||(s[6]=e=>i.isPwdR=!i.isPwdR)},null,8,["name"])]),_:1},8,["modelValue","type"])]),_:1}),l(r,{class:"horizontal"},{default:a(()=>[l(P,{filled:"",multiple:"",label:"Selecciona los Roles",modelValue:i.selectedRoles,"onUpdate:modelValue":s[8]||(s[8]=e=>i.selectedRoles=e),options:t.roles,"option-value":e=>Object(e)===e&&"name"in e?e.name:null,"option-label":e=>Object(e)===e&&"name"in e?e.name:"- Roles -","emit-value":"","map-options":"",style:{"min-width":"250px","max-width":"300px"}},null,8,["modelValue","options","option-value","option-label"])]),_:1}),l(b),l(E,null,{default:a(()=>[l(f,{label:"Enviar",icon:"send",type:"submit",color:"primary",flat:"",class:"q-ml-sm",onClick:s[9]||(s[9]=e=>m.AddUser())}),l(f,{label:"Cancelar",icon:"cancel",type:"reset",color:"primary",flat:"",class:"q-ml-sm",onClick:s[10]||(s[10]=e=>m.ClosedNewUser())})]),_:1})]),_:1})]),_:1},8,["modelValue"])])]),u("template",null,[u("div",H,[l(V,{modelValue:t.editUser,"onUpdate:modelValue":s[24]||(s[24]=e=>t.editUser=e),persistent:""},{default:a(()=>[l(U,{class:"my-card",flat:"",bordered:""},{default:a(()=>[l(r,null,{default:a(()=>[K]),_:1}),l(b),l(r,{class:"horizontal"},{default:a(()=>[l(n,{filled:"",modelValue:t.usuario.username,"onUpdate:modelValue":s[12]||(s[12]=e=>t.usuario.username=e),label:"Usuario *","lazy-rules":"",rules:[e=>e&&e.length>0||"Debe introducir un nombre de usuario"]},null,8,["modelValue","rules"])]),_:1}),l(r,{class:"horizontal"},{default:a(()=>[l(n,{filled:"",modelValue:t.usuario.name,"onUpdate:modelValue":s[13]||(s[13]=e=>t.usuario.name=e),label:"Nombre "},null,8,["modelValue"])]),_:1}),l(r,{class:"horizontal"},{default:a(()=>[l(n,{filled:"",modelValue:t.usuario.lastname,"onUpdate:modelValue":s[14]||(s[14]=e=>t.usuario.lastname=e),label:"Apellidos "},null,8,["modelValue"])]),_:1}),l(r,{class:"horizontal"},{default:a(()=>[l(n,{filled:"",modelValue:t.usuario.email,"onUpdate:modelValue":s[15]||(s[15]=e=>t.usuario.email=e),label:"Email "},null,8,["modelValue"])]),_:1}),l(r,{class:"horizontal"},{default:a(()=>[l(n,{modelValue:t.passwordEdit,"onUpdate:modelValue":s[17]||(s[17]=e=>t.passwordEdit=e),filled:"",type:i.isPwdE?"password":"text",label:"Contrasena"},{append:a(()=>[l(g,{name:i.isPwdE?"visibility_off":"visibility",class:"cursor-pointer",onClick:s[16]||(s[16]=e=>i.isPwdE=!i.isPwdE)},null,8,["name"])]),_:1},8,["modelValue","type"])]),_:1}),l(r,{class:"horizontal"},{default:a(()=>[l(n,{modelValue:t.repeatPasswordEdit,"onUpdate:modelValue":s[19]||(s[19]=e=>t.repeatPasswordEdit=e),filled:"",type:i.isPwdRE?"password":"text",label:"Repetir Contrasena"},{append:a(()=>[l(g,{name:i.isPwdRE?"visibility_off":"visibility",class:"cursor-pointer",onClick:s[18]||(s[18]=e=>i.isPwdRE=!i.isPwdRE)},null,8,["name"])]),_:1},8,["modelValue","type"])]),_:1}),l(r,{class:"horizontal"},{default:a(()=>[l(P,{filled:"",multiple:"",label:"Selecciona los Roles",modelValue:t.usuario.roles,"onUpdate:modelValue":s[20]||(s[20]=e=>t.usuario.roles=e),options:t.roles,"option-value":e=>Object(e)===e&&"name"in e?e.name:null,"option-label":e=>Object(e)===e&&"name"in e?e.name:"- Roles -","emit-value":"","map-options":"",style:{"min-width":"250px","max-width":"350px"}},null,8,["modelValue","options","option-value","option-label"])]),_:1}),l(b),l(r,{class:"horizontal"},{default:a(()=>[l(E,null,{default:a(()=>[l(f,{label:"Enviar",icon:"send",type:"submit",color:"primary",flat:"",class:"q-ml-sm",onClick:s[21]||(s[21]=e=>m.EditUser())}),l(f,{label:"Eliminar",icon:"delete",type:"submit",color:"negative",flat:"",class:"q-ml-sm",onClick:s[22]||(s[22]=e=>i.confirm=!0)}),l(f,{label:"Cerrar",icon:"cancel",type:"cancel",color:"primary",flat:"",class:"q-ml-sm",onClick:s[23]||(s[23]=e=>m.ClosedEditUser())})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])])]),l(S,{position:"top-right",offset:[18,18]},{default:a(()=>[Q((C(),q(D,{icon:"add",direction:"down",color:"primary",disable:o.draggingFab},{default:a(()=>[l(k,{onClick:s[25]||(s[25]=e=>m.exportTable()),color:"positive",icon:"download",disable:o.draggingFab},{default:a(()=>[l(z,null,{default:a(()=>[c(" Descargar ")]),_:1})]),_:1},8,["disable"]),l(k,{onClick:s[26]||(s[26]=e=>m.OpenNewUsuario()),color:"positive",icon:"person_add",disable:o.draggingFab},{default:a(()=>[l(z,null,{default:a(()=>[c(" Nuevo ")]),_:1})]),_:1},8,["disable"])]),_:1},8,["disable"])),[[L,o.moveFab,void 0,{prevent:!0,mouse:!0}]])]),_:1}),u("template",null,[u("div",W,[l(V,{modelValue:i.confirm,"onUpdate:modelValue":s[28]||(s[28]=e=>i.confirm=e),persistent:""},{default:a(()=>[l(U,null,{default:a(()=>[l(r,{class:"row items-center"},{default:a(()=>[l(A,{icon:"priority_high",color:"primary","text-color":"white"}),X]),_:1}),l(E,{align:"right"},{default:a(()=>[Q(l(f,{label:"Cancelar",icon:"cancel",type:"cancel",color:"primary",flat:"",class:"q-ml-sm"},null,512),[[T]]),l(f,{label:"Eliminar",icon:"delete",type:"submit",color:"negative",flat:"",class:"q-ml-sm",onClick:s[27]||(s[27]=e=>m.DeleteUser())})]),_:1})]),_:1})]),_:1},8,["modelValue"])])])]),_:1})}var he=N(I,[["render",Y]]);export{he as default};
