import{_ as b,o as y,c as q,w as o,a as t,J as l,f as c,aw as n,N as m,e as s,af as g,M as _}from"./index.ef228992.js";import{b as v,Q as w,a as i,g as Q}from"./QTable.54a77e6e.js";import{Q as h}from"./QInput.a2bee355.js";import{Q as k}from"./QCardActions.bed2bb53.js";import{Q as C}from"./QPage.2fc420a1.js";import{api as d}from"./axios.23aa70c0.js";import{u as V}from"./use-quasar.38626e8f.js";import{a as p}from"./authenticate.bcdfbf4f.js";import{h as A}from"./moment.9709ab41.js";import"./format.6bd9982d.js";import"./use-key-composition.25c6204a.js";import"./QItemLabel.1cc16253.js";import"./js.cookie.f93afda9.js";V();const P={name:"PagoPage",data(){return{factura:{id:"",consecutivofactura:"",nombreproyecto:"",status:"",cliente:{id:"",nombre:""},cuentaporcobrar:{id:"",montoinicial:0,montorestante:0}},pago:{idfactura:"",idcuenta:"",pago:0,numerocheque:""},pagos:[],cuentas:[],colum:[{label:"Cuenta",name:"cuenta.numerocuenta",required:!0,align:"center",field:e=>e.cuenta.numerocuenta,format:e=>`${e}`,sortable:!0},{label:"Banco",name:"cuenta.banco",required:!0,align:"center",field:e=>e.cuenta.banco,format:e=>`${e}`,sortable:!0},{label:"Moneda",name:"cuenta.moneda.valor",required:!0,align:"center",field:e=>e.cuenta.moneda.valor,format:e=>`${e}`,sortable:!0},{label:"Monto",name:"pago",required:!0,align:"center",field:e=>e.pago,format:e=>`${e}`,sortable:!0},{label:"No. Cheque",name:"numerocheque",required:!0,align:"center",field:e=>e.numerocheque,format:e=>`${e}`,sortable:!0},{label:"Fecha",name:"createdAt",required:!0,align:"center",field:e=>e.createdAt,format:e=>`${e}`,sortable:!0}]}},components:{},methods:{formatFecha(e){return A(e).format("DD/MM/YYYY")},async LoadFactura(){await d.get("/pago-factura/getbyidfactura/"+this.$route.params.idfactura,{headers:{Authorization:`Bearer ${p.getUserLogged()}`}}).then(e=>{this.factura=e.data,this.pagos=e.data.pagos,console.log(this.rows)}).catch(e=>this.$q.notify({type:"negative",position:"top",message:e.response.data.message}))},async AddPago(){await d.post("/pago-factura/",{idcuenta:this.pago.idcuenta,idfactura:this.$route.params.idfactura,pago:this.pago.pago,numerocheque:this.pago.numerocheque},{headers:{Authorization:`Bearer ${p.getUserLogged()}`}}).then(e=>{this.factura=e.data,this.rows=e.data.pagos,this.$q.notify({color:"positive",position:"top",message:"Se inserto el pago ",icon:"done"})}).catch(e=>this.$q.notify({type:"negative",position:"top",message:e.response.data.message})),this.LoadFactura(),this.pago.pago=0,this.pago.numerocheque=""},async loadCuentas(){await d.get("/cuentas-empresa/",{headers:{Authorization:`Bearer ${p.getUserLogged()}`}}).then(e=>{this.cuentas=e.data}).catch(e=>this.$q.notify({type:"negative",position:"top",message:e.response.data.message}))}},mounted(){this.LoadFactura(),this.loadCuentas()}},B=c("div",{class:"text-h5 q-mt-sm q-mb-xs"},"Adicionar Pago ",-1);function M(e,u,x,z,r,f){return y(),q(C,{class:"q-pa-md"},{default:o(()=>[t(m,{class:"my-card"},{default:o(()=>[t(l,null,{default:o(()=>[c("p",null,"Factura: "+n(r.factura.consecutivofactura),1),c("p",null,"Cliente: "+n(r.factura.cliente.nombre),1),c("p",null,"Monto Inicial: "+n(r.factura.cuentaporcobrar.montoinicial),1),c("p",null,"Monto Pendiente: "+n(r.factura.cuentaporcobrar.montorestante),1)]),_:1})]),_:1}),t(m,{class:"my-card"},{default:o(()=>[t(l,null,{default:o(()=>[t(v,{flat:"",bordered:"",title:"Pagos Realizados",rows:r.pagos,columns:r.colum,color:"primary","row-key":"name",filter:e.filter},{body:o(a=>[t(w,{props:a},{default:o(()=>[t(i,{key:"cuenta.numerocuenta",props:a},{default:o(()=>[s(n(a.row.cuenta.numerocuenta),1)]),_:2},1032,["props"]),t(i,{key:"cuenta.numerocuenta",props:a},{default:o(()=>[s(n(a.row.cuenta.banco),1)]),_:2},1032,["props"]),t(i,{key:"cuenta.moneda.valor",props:a},{default:o(()=>[s(n(a.row.cuenta.moneda.valor),1)]),_:2},1032,["props"]),t(i,{key:"pago",props:a},{default:o(()=>[s(n(a.row.pago),1)]),_:2},1032,["props"]),t(i,{key:"numerocheque",props:a},{default:o(()=>[s(n(a.row.numerocheque),1)]),_:2},1032,["props"]),t(i,{key:"createdAt",props:a},{default:o(()=>[s(n(f.formatFecha(a.row.createdAt)),1)]),_:2},1032,["props"])]),_:2},1032,["props"])]),_:1},8,["rows","columns","filter"])]),_:1})]),_:1}),t(m,{class:"my-card"},{default:o(()=>[t(l,null,{default:o(()=>[B]),_:1}),t(g),t(l,{class:"horizontal"},{default:o(()=>[t(Q,{filled:"",modelValue:r.pago.idcuenta,"onUpdate:modelValue":u[0]||(u[0]=a=>r.pago.idcuenta=a),options:r.cuentas,"option-value":a=>Object(a)===a&&"id"in a?a.id:null,"option-label":a=>Object(a)===a&&"numerocuenta"in a?a.numerocuenta:"- Numero Cuenta -","emit-value":"","map-options":""},null,8,["modelValue","options","option-value","option-label"])]),_:1}),t(l,{class:"horizontal"},{default:o(()=>[t(h,{filled:"",modelValue:r.pago.pago,"onUpdate:modelValue":u[1]||(u[1]=a=>r.pago.pago=a),label:"Monto",mask:"#.##","fill-mask":"0","reverse-fill-mask":"","input-class":"text-right"},null,8,["modelValue"])]),_:1}),t(l,{class:"horizontal"},{default:o(()=>[t(h,{filled:"",modelValue:r.pago.numerocheque,"onUpdate:modelValue":u[2]||(u[2]=a=>r.pago.numerocheque=a),label:"Numero de Cheque"},null,8,["modelValue"])]),_:1}),t(g),t(k,null,{default:o(()=>[t(_,{label:"Enviar",icon:"send",type:"submit",color:"primary",flat:"",class:"q-ml-sm",onClick:u[3]||(u[3]=a=>f.AddPago())})]),_:1})]),_:1})]),_:1})}var J=b(P,[["render",M]]);export{J as default};
