import{Q as F,a as p,b as N,h as A,g as _}from"./QTable.54a77e6e.js";import{_ as S,n as g,o as q,c as C,w as l,f as n,a as o,e as d,aw as f,N as v,J as m,af as b,M as u,ax as P,ah as V,Q as U}from"./index.ef228992.js";import{Q}from"./QInput.a2bee355.js";import{Q as w}from"./QCardActions.bed2bb53.js";import{Q as D,a as k,b as x,c as E}from"./QPageSticky.a179ccb3.js";import{Q as z}from"./QPage.2fc420a1.js";import{T as B}from"./TouchPan.9047fff0.js";import{C as T}from"./ClosePopup.6197016b.js";import{api as y}from"./axios.23aa70c0.js";import{e as O}from"./export-file.dc78ba05.js";import{u as L}from"./use-quasar.38626e8f.js";import{a as h}from"./authenticate.bcdfbf4f.js";import{h as $}from"./moment.9709ab41.js";import"./format.6bd9982d.js";import"./use-key-composition.25c6204a.js";import"./QItemLabel.1cc16253.js";import"./js.cookie.f93afda9.js";function j(e,a,c){let i=a!==void 0?a(e,c):e;return i=i==null?"":String(i),i=i.split('"').join('""'),`"${i}"`}const Y=L(),I={name:"ProyectoPage",data(){return{newProyecto:!1,editProyecto:!1,rows:[],columns:[{label:"Nombre",name:"name",required:!0,align:"center",field:e=>e.name,format:e=>`${e}`,sortable:!0},{label:"Nombre Cliente",name:"cliente.nombre",required:!0,align:"center",field:e=>e.cliente.nombre,format:e=>`${e}`,sortable:!0},{label:"Estado",name:"status",required:!0,align:"center",field:e=>e.status,format:e=>`${e}`,sortable:!0},{label:"Fecha Inicio",name:"fecha_inicio",required:!0,align:"center",field:e=>e.fecha_inicio,format:e=>`${e}`,sortable:!0},{label:"Fecha Fin",name:"fecha_fin",required:!0,align:"center",field:e=>e.fecha_fin,format:e=>`${e}`,sortable:!0},{label:"Por Ajuste",name:"ajuste",required:!0,align:"center",field:e=>e.ajuste,format:e=>`${e}`,sortable:!0}],proyectos:[],proyecto:{name:"",cliente:{},status:"",fecha_inicio:"",fecha_fin:"",ajuste:!1},ideselected:0,clientes:[]}},components:{},methods:{loadProyecto(){y.get("/proyecto/",{headers:{Authorization:`Bearer ${h.getUserLogged()}`}}).then(e=>{this.rows=e.data}).catch(e=>this.$q.notify({type:"negative",position:"top",message:e.response.data.message}))},loadCliente(){y.get("/cliente/",{headers:{Authorization:`Bearer ${h.getUserLogged()}`}}).then(e=>{this.clientes=e.data}).catch(e=>this.$q.notify({type:"negative",position:"top",message:e.response.data.message}))},OpenNewProyecto(){this.proyecto={},this.newProyecto=!0},ClosedNewProyecto(){this.proyecto={},this.newProyecto=!1},FormatoFecha(e){return e?$(String(e)).format("MM/DD/YYYY hh:mm"):"-"},FormatoAjuste(e){return e===!0?"SI":"NO"},async AddProyecto(){if(this.proyecto.name!==""&this.proyecto.cliente!==""){const e={name:this.proyecto.name,idCliente:this.proyecto.cliente,ajuste:this.ajuste};await y.post("/proyecto/",e,{headers:{Authorization:`Bearer ${h.getUserLogged()}`}}).then(a=>{this.$q.notify({color:"positive",position:"top",message:"Se inserto el proyecto "+a.data.name,icon:"done"})}).catch(a=>this.$q.notify({type:"negative",position:"top",message:a.response.data.message})),this.newProyecto=!1,this.loadProyecto()}else this.$q.notify({color:"negative",position:"top",message:"Llene los capos requeridos",icon:"report_problem"})},OpenEdit(){this.editProyecto=!0},async EditProyecto(){this.proyecto.name!==""&this.proyecto.cliente.name!==""?(await y.patch("/proyecto/"+this.idselected,this.proyecto,{headers:{Authorization:`Bearer ${h.getUserLogged()}`}}).then(e=>{this.$q.notify({color:"positive",position:"top",message:"Se edit\xF3 el proyecto "+e.data.name,icon:"done"})}).catch(e=>this.$q.notify({type:"negative",position:"top",message:e.response.data.message})),this.editProyecto=!1,this.loadproyecto()):this.$q.notify({color:"negative",position:"top",message:"Llene los capos requeridos",icon:"report_problem"})},ClosedEditProyecto(){this.proyecto={},this.editProyecto=!1},async DeleteProyecto(){await y.delete("/proyecto/"+this.idselected,{headers:{Authorization:`Bearer ${h.getUserLogged()}`}}).then(e=>{this.$q.notify({color:"positive",position:"top",message:"Se Desahabilito el proyecto del sistema "+e.data.name,icon:"done"})}).catch(e=>this.$q.notify({type:"negative",position:"top",message:e.response.data.message})),this.confirm=!1,this.editProyecto=!1,this.loadProyecto()},onRowClick(e){this.idselected=e.id,this.$router.push({path:"/detalleproyecto/"+e.id,params:{idproyecto:this.idselected}}),this.proyecto.name=e.name,this.proyecto.cliente=e.cliente,this.proyecto.fecha_fin=e.fecha_fin,this.proyecto.fecha_inicio=e.fecha_inicio,this.proyecto.status=e.status},exportTable(){const e=[this.columns.map(c=>j(c.label))].concat(this.rows.map(c=>this.columns.map(i=>j(typeof i.field=="function"?i.field(c):c[i.field===void 0?i.name:i.field],i.format,c)).join(","))).join(`\r
`);O("table-export.csv",e,"text/csv")!==!0&&Y.notify({message:"Browser denied file download...",color:"negative",icon:"warning"})}},mounted(){this.loadProyecto(),this.loadCliente()},setup(){return{selected:g([]),confirm:g(!1),ajuste:g(!1)}}},M={class:"q-pa-md"},R={class:"q-pa-md q-gutter-sm"},J=n("div",{class:"text-h6"},"Nuevo Proyecto",-1),G={class:"q-pa-md q-gutter-sm"},H=n("div",{class:"text-h6"},"Editar Proyecto",-1),K={class:"q-pt-none",style:{"max-width":"700px"}},W={class:"q-pa-md q-gutter-sm"},X=n("span",{class:"q-ml-sm"},"Desea desahabilitar el proyecto?.",-1);function Z(e,a,c,i,s,r){return q(),C(z,{class:"q-pa-md"},{default:l(()=>[n("div",M,[o(N,{flat:"",bordered:"",title:"Proyectos",rows:s.rows,columns:s.columns,color:"primary","row-key":"name"},{body:l(t=>[o(F,{props:t,onClick:ee=>r.onRowClick(t.row)},{default:l(()=>[o(p,{key:"name",props:t},{default:l(()=>[d(f(t.row.name),1)]),_:2},1032,["props"]),o(p,{key:"cliente.nombre",props:t},{default:l(()=>[d(f(t.row.cliente.nombre),1)]),_:2},1032,["props"]),o(p,{key:"status",props:t},{default:l(()=>[d(f(t.row.status),1)]),_:2},1032,["props"]),o(p,{key:"fecha_inicio",props:t},{default:l(()=>[d(f(r.FormatoFecha(t.row.fecha_inicio)),1)]),_:2},1032,["props"]),o(p,{key:"fecha_fin",props:t},{default:l(()=>[d(f(r.FormatoFecha(t.row.fecha_fin)),1)]),_:2},1032,["props"]),o(p,{key:"ajuste",props:t},{default:l(()=>[d(f(r.FormatoAjuste(t.row.ajuste)),1)]),_:2},1032,["props"])]),_:2},1032,["props","onClick"])]),_:1},8,["rows","columns"])]),n("template",null,[n("div",R,[o(P,{modelValue:s.newProyecto,"onUpdate:modelValue":a[5]||(a[5]=t=>s.newProyecto=t),persistent:""},{default:l(()=>[o(v,{class:"my-card",flat:"",bordered:""},{default:l(()=>[o(m,null,{default:l(()=>[J]),_:1}),o(b),o(m,{class:"horizontal"},{default:l(()=>[o(Q,{modelValue:s.proyecto.name,"onUpdate:modelValue":a[0]||(a[0]=t=>s.proyecto.name=t),filled:"",type:"textarea",label:"Nombre","lazy-rules":"",rules:[t=>t&&t.length>0||"Debe introducir un nombre "]},null,8,["modelValue","rules"])]),_:1}),o(m,{class:"horizontal"},{default:l(()=>[o(A,{modelValue:i.ajuste,"onUpdate:modelValue":a[1]||(a[1]=t=>i.ajuste=t),color:"secondary",label:"Por Ajuste?"},null,8,["modelValue"])]),_:1}),o(m,{class:"horizontal"},{default:l(()=>[o(_,{filled:"",label:"Selecciona un Cliente",modelValue:s.proyecto.cliente,"onUpdate:modelValue":a[2]||(a[2]=t=>s.proyecto.cliente=t),options:s.clientes,"option-value":t=>Object(t)===t&&"id"in t?t.id:null,"option-label":t=>Object(t)===t&&"nombre"in t?t.nombre:"- Clientes -","emit-value":"","map-options":"",style:{"min-width":"250px","max-width":"300px"}},null,8,["modelValue","options","option-value","option-label"])]),_:1}),o(b),o(w,null,{default:l(()=>[o(u,{label:"Enviar",icon:"send",type:"submit",color:"primary",flat:"",class:"q-ml-sm",onClick:a[3]||(a[3]=t=>r.AddProyecto())}),o(u,{label:"Cancelar",icon:"cancel",type:"reset",color:"primary",flat:"",class:"q-ml-sm",onClick:a[4]||(a[4]=t=>r.ClosedNewProyecto())})]),_:1})]),_:1})]),_:1},8,["modelValue"])])]),n("template",null,[n("div",G,[o(P,{modelValue:s.editProyecto,"onUpdate:modelValue":a[11]||(a[11]=t=>s.editProyecto=t),persistent:""},{default:l(()=>[o(v,{class:"my-card",flat:"",bordered:""},{default:l(()=>[o(m,null,{default:l(()=>[H]),_:1}),o(b),o(m,null,{default:l(()=>[n("div",K,[o(Q,{modelValue:s.proyecto.name,"onUpdate:modelValue":a[6]||(a[6]=t=>s.proyecto.name=t),filled:"",type:"textarea",label:"Nombre",hint:"Nombre del Proyecto","lazy-rules":"",rules:[t=>t&&t.length>0||"Debe introducir un nombre "]},null,8,["modelValue","rules"]),o(_,{filled:"",label:"Selecciona un Cliente",modelValue:s.proyecto.cliente,"onUpdate:modelValue":a[7]||(a[7]=t=>s.proyecto.cliente=t),options:s.clientes,"option-value":t=>Object(t)===t&&"id"in t?t.id:null,"option-label":t=>Object(t)===t&&"nombre"in t?t.nombre:"- Clientes -","emit-value":"","map-options":"",style:{"min-width":"250px","max-width":"300px"}},null,8,["modelValue","options","option-value","option-label"])])]),_:1}),o(b),o(w,null,{default:l(()=>[o(u,{label:"Enviar",icon:"send",type:"submit",color:"primary",flat:"",class:"q-ml-sm",onClick:a[8]||(a[8]=t=>r.EditProyecto())}),o(u,{label:"Eliminar",icon:"delete",type:"submit",color:"negative",flat:"",class:"q-ml-sm",onClick:a[9]||(a[9]=t=>i.confirm=!0)}),o(u,{label:"Cerrar",icon:"cancel",type:"cancel",color:"primary",flat:"",class:"q-ml-sm",onClick:a[10]||(a[10]=t=>r.ClosedEditProyecto())})]),_:1})]),_:1})]),_:1},8,["modelValue"])])]),o(E,{position:"top-right",offset:[18,18]},{default:l(()=>[V((q(),C(D,{icon:"add",direction:"down",color:"primary",disable:e.draggingFab},{default:l(()=>[o(k,{onClick:a[12]||(a[12]=t=>r.exportTable()),color:"positive",icon:"download",disable:e.draggingFab},{default:l(()=>[o(x,null,{default:l(()=>[d(" Descargar ")]),_:1})]),_:1},8,["disable"]),o(k,{onClick:a[13]||(a[13]=t=>r.OpenNewProyecto()),color:"positive",icon:"add_box",disable:e.draggingFab},{default:l(()=>[o(x,null,{default:l(()=>[d(" Nuevo ")]),_:1})]),_:1},8,["disable"])]),_:1},8,["disable"])),[[B,e.moveFab,void 0,{prevent:!0,mouse:!0}]])]),_:1}),n("template",null,[n("div",W,[o(P,{modelValue:i.confirm,"onUpdate:modelValue":a[15]||(a[15]=t=>i.confirm=t),persistent:""},{default:l(()=>[o(v,null,{default:l(()=>[o(m,{class:"row items-center"},{default:l(()=>[o(U,{icon:"priority_high",color:"primary","text-color":"white"}),X]),_:1}),o(w,{align:"right"},{default:l(()=>[V(o(u,{label:"Cancelar",icon:"cancel",type:"cancel",color:"primary",flat:"",class:"q-ml-sm"},null,512),[[T]]),o(u,{label:"Eliminar",icon:"delete",type:"submit",color:"negative",flat:"",class:"q-ml-sm",onClick:a[14]||(a[14]=t=>r.DeleteProyecto())})]),_:1})]),_:1})]),_:1},8,["modelValue"])])])]),_:1})}var ge=S(I,[["render",Z]]);export{ge as default};
