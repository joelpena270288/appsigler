import{_ as F,o as b,c as T,w as i,f as n,a,J as d,aw as l,af as p,e as u,N as _,ah as v,M as A,ax as x,O as L,P as I}from"./index.ef228992.js";import{b as N,Q as C,a as c}from"./QTable.54a77e6e.js";import{Q as B,a as m,b as h,c as w}from"./QPageSticky.a179ccb3.js";import{Q as O}from"./QInput.a2bee355.js";import{Q as R}from"./QCardActions.bed2bb53.js";import{Q as k}from"./QPage.2fc420a1.js";import{T as P}from"./TouchPan.9047fff0.js";import{api as y}from"./axios.23aa70c0.js";import{u as U}from"./use-quasar.38626e8f.js";import{a as g}from"./authenticate.bcdfbf4f.js";import{u as D}from"./index.403b85a6.js";import{h as E}from"./moment.9709ab41.js";import"./format.6bd9982d.js";import"./use-key-composition.25c6204a.js";import"./QItemLabel.1cc16253.js";import"./js.cookie.f93afda9.js";U();const G={name:"PreFacturaDetailPage",data(){return{editNota:!1,empresa:{},factura:{id:"",nombreproyecto:"",cliente:{id:"",nombre:""}},prefacturas:[],columsprefactura:[{label:"Cantidad",name:"cantidad",required:!0,align:"center",field:t=>t.cantidad,format:t=>`${t}`,sortable:!0},{label:"UM",name:"UM",required:!0,align:"center",field:t=>t.UM,format:t=>`${t}`,sortable:!0},{label:"Servicio",name:"nombreServicio",required:!0,align:"center",field:t=>t.nombreServicio,format:t=>`${t}`,sortable:!0},{label:"Precio",name:"precio",required:!0,align:"center",field:t=>t.precio,format:t=>`${t}`,sortable:!0},{label:"Importe",name:"importe",required:!0,align:"center",field:t=>t.importe,format:t=>`${t}`,sortable:!0},{label:"Importe ITBI",name:"importeimpuesto",required:!0,align:"center",field:t=>t.importeimpuesto,format:t=>`${t}`,sortable:!0},{label:"Importe Total",name:"valortotal",required:!0,align:"center",field:t=>t.valortotal,format:t=>`${t}`,sortable:!0}],pdfmake:D(),SUBTOTALGENERAL:0,ITBIS:0,TOTALGENERAL:0,bodyTable:[["CANT.","MEDIDA","PRECIO","DESCRIPCION","ITBIS","VALOR"]]}},methods:{async loadEmpresa(){await y.get("/empresa",{headers:{Authorization:`Bearer ${g.getUserLogged()}`}}).then(t=>{this.empresa=t.data}).catch(t=>this.$q.notify({type:"negative",position:"top",message:t.response.data.message}))},Totales(){this.SUBTOTALGENERAL=0,this.ITBIS=0,this.TOTALGENERAL=0;for(let t=0;t<this.prefacturas.length;t++){let o=[this.prefacturas[t].cantidad,this.prefacturas[t].UM,(this.prefacturas[t].precio/this.factura.tasadia).toFixed(2),this.prefacturas[t].nombreServicio,(this.prefacturas[t].importeimpuesto/this.factura.tasadia).toFixed(2),(this.prefacturas[t].importe/this.factura.tasadia).toFixed(2)];this.SUBTOTALGENERAL+=parseFloat(this.prefacturas[t].importe/this.factura.tasadia),this.ITBIS+=parseFloat(this.prefacturas[t].importeimpuesto/this.factura.tasadia),this.TOTALGENERAL+=parseFloat(this.prefacturas[t].valortotal/this.factura.tasadia),this.bodyTable.push(o)}},CalcularTasa(t){return(parseFloat(t.toString())/this.factura.tasadia).toFixed(2)},onGenPDF(){if(this.prefacturas.length>0){let o="",f="ITBIS: ",S=this.factura.notafactura,s="SUBTOTALGENERAL: "+this.SUBTOTALGENERAL.toFixed(2);switch(this.ITBIS>0?f+=this.ITBIS.toFixed(2):f="",this.factura.tipoimpuesto){case"B14":{o="COMPROBANTE PARA REGIMENES ESPECIALES",this.bodyTable=[["CANT.","MEDIDA","PRECIO","DESCRIPCION","VALOR","."]];for(let r=0;r<this.prefacturas.length;r++){let e=[this.prefacturas[r].cantidad,this.prefacturas[r].UM,(this.prefacturas[r].precio/this.factura.tasadia).toFixed(2),this.prefacturas[r].nombreServicio,(this.prefacturas[r].importe/this.factura.tasadia).toFixed(2),"."];this.SUBTOTALGENERAL+=parseFloat(this.prefacturas[r].importe/this.factura.tasadia),this.ITBIS+=parseFloat(this.prefacturas[r].importeimpuesto/this.factura.tasadia),this.TOTALGENERAL+=parseFloat(this.prefacturas[r].valortotal/this.factura.tasadia),this.bodyTable.push(e)}s="";break}case"B01":{o="FACTURA DE CONTROL FISCAL";break}case"B02":{o="FACTURA DE  CONSUMO";break}}var t={info:{title:"Factura",author:"Equipos Sigler",subject:"subject of document",keywords:"factura, sigler"},pageSize:"LETTER",pageMargins:[40,60,40,60],footer:function(r,e){return"Pagina "+r.toString()+" de "+e},content:[{image:this.empresa.logo,fit:[100,100],style:"header"},{columns:[{width:"auto",text:this.empresa.nombre,style:"negritaStyle"},{width:"*",text:o,style:"marginrightBoldStyle"}]},{columns:[{width:"auto",text:"Tel. "+this.empresa.telefono,style:"anotherStyle"},{width:"*",text:"NCF: "+this.factura.ncf,style:"marginrightBoldStyle"}]},{columns:[{width:"auto",text:this.empresa.email,style:"anotherStyle"},{width:"*",text:"Vencimiento Secuencia: "+E(this.factura.fechancf).format("DD/MM/YYYY"),style:"marginrightBoldStyle"}]},{columns:[{width:"auto",text:"RNC: "+this.empresa.rnc,style:"anotherStyle"},{width:"*",text:"Termino: Credito",style:"marginrightBoldStyle"}]},{columns:[{width:"auto",text:"Fecha Factura: "+E(this.factura.fechafactura).format("DD/MM/YYYY"),style:"anotherStyle"},{width:"*",text:"FACT. NRO.: "+this.factura.consecutivofactura,style:"marginrightBoldStyle"}]},{text:"                                       ",style:"anotherStyle"},{text:"RNC. "+this.factura.cliente.rcn+"    Cod.Cliente: "+this.factura.cliente.consecutivo,style:"anotherStyle"},{text:"NOMBRE O RAZON SOCIAL: "+this.factura.cliente.nombre,style:"anotherStyle"},{text:"TEL. "+this.factura.cliente.telefono,style:"anotherStyle"},{text:"                                              ",style:"anotherStyle"},{text:"PROYECTO: "+this.factura.nombreproyecto,style:"anotherStyle"},{text:"                                              ",style:"anotherStyle"},{text:"                                              ",style:"anotherStyle"},{text:"                                              ",style:"anotherStyle"},{layout:"lightHorizontalLines",table:{headerRows:1,widths:["*","*","*","auto","*","*"],body:this.bodyTable}},{text:"****Ultima linea de producto(s) o servicio(s) facturado(s)****",style:"finTableStyle"},{text:"                                              ",style:"anotherStyle"},{text:"                                              ",style:"anotherStyle"},{text:"                                              ",style:"anotherStyle"},{text:"                                              ",style:"anotherStyle"},{text:s,style:"marginrightStyle"},{text:f,style:"marginrightStyle"},{text:"TOTAL GENERAL: "+this.TOTALGENERAL.toFixed(2),style:"marginrightBoldStyle"},{text:S,style:"anotherStyle"},{text:this.factura.notaprefactura,style:"anotherStyle"},{text:"                  ",style:"anotherStyle"},{text:"                  ",style:"anotherStyle"},{text:"                  ",style:"anotherStyle"},{text:"                  ",style:"anotherStyle"},{text:"                  ",style:"anotherStyle"},{text:"Firma: _____________________             Original: Cliente",style:"anotherStyle"}],styles:{header:{fontSize:18,bold:!0,alignment:"center"},centro:{fontSize:12,bold:!0,alignment:"center"},anotherStyle:{italics:!0,alignment:"left",fontSize:12},finTableStyle:{italics:!0,fontSize:12,alignment:"center",underline:!0},negritaStyle:{italics:!0,alignment:"left",fontSize:12,bold:!0},marginrightStyle:{italics:!0,alignment:"right"},marginrightBoldStyle:{italics:!0,alignment:"right",bold:!0}}};this.pdfmake.tableLayouts={exampleLayout:{hLineWidth:function(r,e){return r===0||r===e.table.body.length?0:r===e.table.headerRows?2:1},vLineWidth:function(r){return 0},hLineColor:function(r){return r===1?"black":"#aaa"},paddingLeft:function(r){return r===0?0:8},paddingRight:function(r,e){return r===e.table.widths.length-1?0:8}}},this.pdfmake.createPdf(t).download()}else this.$q.notify({color:"negative",position:"top",message:"No se pude Generar una prefactura sin al menos un servicio",icon:"report_problem"})},async loadFacturaById(){await y.get("/factura/"+this.$route.params.idfactura,{headers:{Authorization:`Bearer ${g.getUserLogged()}`}}).then(t=>{this.prefacturas=t.data.servicioProcesado,this.factura=t.data}).catch(t=>this.$q.notify({type:"negative",position:"top",message:t.response.data.message})),this.Totales()},IrFactura(){this.$router.push({path:"/detailprefactura/"+this.$route.params.idfactura,params:{idfactura:this.$route.params.idfactura}})},async Nota(){await y.patch("/factura/notafactura/"+this.$route.params.idfactura,{nota:this.factura.notafactura},{headers:{Authorization:`Bearer ${g.getUserLogged()}`}}).then(t=>{this.$q.notify({color:"positive",position:"top",message:"Se Genero la La nota",icon:"done"})}).catch(t=>this.$q.notify({type:"negative",position:"top",message:t.response.data.message})),this.editNota=!1}},mounted(){this.loadFacturaById(),this.loadEmpresa()}},Q=t=>(L("data-v-1abd0f88"),t=t(),I(),t),q={class:"q-pa-md flat bordered"},M={class:"q-pa-md q-gutter-sm"},V=Q(()=>n("div",{class:"text-h6"},"Nota Factura",-1)),z={class:"q-pa-md"};function Y(t,o,f,S,s,r){return b(),T(k,{class:"q-pa-md"},{default:i(()=>[n("div",q,[a(_,{class:"my-card"},{default:i(()=>[a(d,null,{default:i(()=>[n("p",null,"Consecutivo: "+l(s.factura.consecutivofactura),1),n("p",null,"NCF: "+l(s.factura.ncf),1),n("p",null,"Proyecto: "+l(s.factura.nombreproyecto),1),n("p",null,"Cliente: "+l(s.factura.cliente.nombre),1),n("p",null,"Moneda a Facturar: "+l(s.factura.simbolomoneda),1)]),_:1}),a(p),a(d,null,{default:i(()=>[a(N,{flat:"",bordered:"",title:"Servicios Facturados",rows:s.prefacturas,columns:s.columsprefactura,color:"primary","row-key":"name",filter:t.filter},{body:i(e=>[a(C,{props:e},{default:i(()=>[a(c,{key:"cantidad",props:e},{default:i(()=>[u(l(e.row.cantidad),1)]),_:2},1032,["props"]),a(c,{key:"UM",props:e},{default:i(()=>[u(l(e.row.UM),1)]),_:2},1032,["props"]),a(c,{key:"nombreServicio",props:e},{default:i(()=>[u(l(e.row.nombreServicio),1)]),_:2},1032,["props"]),a(c,{key:"precio",props:e},{default:i(()=>[u(l(r.CalcularTasa(e.row.precio)),1)]),_:2},1032,["props"]),a(c,{key:"importe",props:e},{default:i(()=>[u(l(r.CalcularTasa(e.row.importe)),1)]),_:2},1032,["props"]),a(c,{key:"importeimpuesto",props:e},{default:i(()=>[u(l(r.CalcularTasa(e.row.importeimpuesto)),1)]),_:2},1032,["props"]),a(c,{key:"valortotal",props:e},{default:i(()=>[u(l(r.CalcularTasa(e.row.valortotal)),1)]),_:2},1032,["props"])]),_:2},1032,["props"])]),_:1},8,["rows","columns","filter"])]),_:1}),a(d,null,{default:i(()=>[n("p",null," SUBTOTALGENERAL: "+l(s.SUBTOTALGENERAL.toFixed(2)),1),n("p",null," ITBIS: "+l(s.ITBIS.toFixed(2)),1),n("p",null," TOTALGENERAL: "+l(s.TOTALGENERAL.toFixed(2)),1),n("p",null," NOTA: "+l(s.factura.notafactura),1)]),_:1}),a(d)]),_:1})]),a(w,{position:"top-right",offset:[18,18]},{default:i(()=>[v((b(),T(B,{icon:"add",direction:"down",color:"primary",disable:t.draggingFab},{default:i(()=>[a(m,{onClick:o[0]||(o[0]=e=>s.editNota=!0),color:"positive",icon:"edit_note",disable:t.draggingFab},{default:i(()=>[a(h,null,{default:i(()=>[u(" Nota ")]),_:1})]),_:1},8,["disable"]),a(m,{onClick:o[1]||(o[1]=e=>r.onGenPDF()),color:"positive",icon:"print",disable:t.draggingFab},{default:i(()=>[a(h,null,{default:i(()=>[u(" Imprimir ")]),_:1})]),_:1},8,["disable"]),a(m,{onClick:o[2]||(o[2]=e=>r.IrFactura()),color:"positive",icon:"search",disable:t.draggingFab},{default:i(()=>[a(h,null,{default:i(()=>[u(" Ir PreFactura ")]),_:1})]),_:1},8,["disable"])]),_:1},8,["disable"])),[[P,t.moveFab,void 0,{prevent:!0,mouse:!0}]])]),_:1}),n("template",null,[n("div",M,[a(x,{modelValue:s.editNota,"onUpdate:modelValue":o[6]||(o[6]=e=>s.editNota=e),persistent:""},{default:i(()=>[a(_,{class:"my-card",flat:"",bordered:""},{default:i(()=>[a(d,null,{default:i(()=>[V]),_:1}),a(p),a(d,{class:"horizontal"},{default:i(()=>[n("div",z,[a(O,{modelValue:s.factura.notafactura,"onUpdate:modelValue":o[3]||(o[3]=e=>s.factura.notafactura=e),filled:"",type:"textarea"},null,8,["modelValue"])])]),_:1}),a(p),a(R,null,{default:i(()=>[a(A,{label:"Enviar",icon:"send",type:"submit",color:"primary",flat:"",class:"q-ml-sm",onClick:o[4]||(o[4]=e=>r.Nota())}),a(A,{label:"Cerrar",icon:"cancel",type:"cancel",color:"primary",flat:"",class:"q-ml-sm",onClick:o[5]||(o[5]=e=>s.editNota=!1)})]),_:1})]),_:1})]),_:1},8,["modelValue"])])])]),_:1})}var nt=F(G,[["render",Y],["__scopeId","data-v-1abd0f88"]]);export{nt as default};
