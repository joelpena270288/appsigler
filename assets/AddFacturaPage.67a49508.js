import{_ as F,n as x,o as S,b2 as I,a as i,w as t,f as c,ax as y,b3 as M,N as v,J as n,aw as u,af as z,e as d,ah as w,c as N,M as h,L as A,Q as B}from"./index.ef228992.js";import{b as U,Q as k,a as m,g}from"./QTable.54a77e6e.js";import{c as D,a as _,b as V,Q as T}from"./QPageSticky.a179ccb3.js";import{Q as f}from"./QInput.a2bee355.js";import{Q as q}from"./QCardActions.bed2bb53.js";import{Q as j}from"./QPage.2fc420a1.js";import{T as E}from"./TouchPan.9047fff0.js";import{C as O}from"./ClosePopup.6197016b.js";import{api as b}from"./axios.23aa70c0.js";import{e as L}from"./export-file.dc78ba05.js";import{u as Y}from"./use-quasar.38626e8f.js";import{a as C}from"./authenticate.bcdfbf4f.js";import{h as R}from"./moment.9709ab41.js";import"./format.6bd9982d.js";import"./use-key-composition.25c6204a.js";import"./QItemLabel.1cc16253.js";import"./js.cookie.f93afda9.js";function P(e,a,p){let r=a!==void 0?a(e,p):e;return r=r==null?"":String(r),r=r.split('"').join('""'),`"${r}"`}const K=Y(),H={name:"AddFacturaPage",data(){return{proyectos:[],proyecto:{id:"",cliente:"",fecha_inicio:""},optionsUnidad:["Hora","Serv","Viaje","m2","m3"],findProy:!1,columsproyecto:[{label:"Nombre",name:"name",required:!0,align:"lefth",field:e=>e.name,format:e=>`${e}`,sortable:!0},{label:"Cliente",name:"cliente",required:!0,align:"lefth",field:e=>e.cliente.nombre,format:e=>`${e}`,sortable:!0},{label:"Fecha Inicio",name:"fecha_inicio",required:!0,align:"lefth",field:e=>e.fecha_inicio,format:e=>`${e}`,sortable:!0}],cotizacion:[],columscotizacion:[{label:"Cantidad",name:"cantidad",required:!0,align:"lefth",field:e=>e.cantidad,format:e=>`${e}`,sortable:!0},{label:"Unidad",name:"UM",required:!0,align:"lefth",field:e=>e.UM,format:e=>`${e}`,sortable:!0},{label:"Servicio",name:"nombreServicio",required:!0,align:"lefth",field:e=>e.nombreServicio,format:e=>`${e}`,sortable:!0},{label:"Precio Unitario RD$",name:"precio",required:!0,align:"lefth",field:e=>e.precio,format:e=>`${e}`,sortable:!0},{label:"Sub Total RD$",name:"subtotal",required:!0,align:"lefth",field:e=>e.subtotal,format:e=>`${e}`,sortable:!0},{label:"Impuesto RD$",name:"importeimpuesto",required:!0,align:"lefth",field:e=>e.importeImpuesto,format:e=>`${e}`,sortable:!0}],newCotizacion:!1,nuevaCotizacion:{cantidad:0,UM:"",nombreServicio:"",precio:0,subtotal:0,valorimpuesto:0,importeImpuesto:0},servicios:[],impuestos:[],confirmarEliminar:!1}},components:{},methods:{AbrirNuevaCotizacion(){this.newCotizacion=!0},FormatoFecha(e){return R(String(e)).format("MM/DD/YYYY hh:mm")},loadProyecto(){b.get("proyecto/aprobados/conduce/",{headers:{Authorization:`Bearer ${C.getUserLogged()}`}}).then(e=>{this.proyectos=e.data}).catch(e=>this.$q.notify({type:"negative",position:"top",message:e.response.data.message}))},loadServicio(){b.get("/servicio/",{headers:{Authorization:`Bearer ${C.getUserLogged()}`}}).then(e=>{this.servicios=e.data}).catch(e=>this.$q.notify({type:"negative",position:"top",message:e.response.data.message}))},OpenProyectos(){this.limpiarCotizacio(),this.findProy=!0},selectProyecto(e){this.proyecto.id=e.id,this.proyecto.name=e.name,this.proyecto.cliente=e.cliente.nombre,this.proyecto.fecha_inicio=e.fecha_inicio,this.findProy=!1},exportTable(){const e=[this.columns.map(p=>P(p.label))].concat(this.rows.map(p=>this.columns.map(r=>P(typeof r.field=="function"?r.field(p):p[r.field===void 0?r.name:r.field],r.format,p)).join(","))).join(`\r
`);L("table-export.csv",e,"text/csv")!==!0&&K.notify({message:"Browser denied file download...",color:"negative",icon:"warning"})},sumar(){this.nuevaCotizacion.subtotal=(parseFloat(this.nuevaCotizacion.cantidad)*parseFloat(this.nuevaCotizacion.precio)).toFixed(2),this.nuevaCotizacion.importeImpuesto=(parseFloat(this.nuevaCotizacion.subtotal)*parseFloat(this.nuevaCotizacion.valorimpuesto)).toFixed(2)},AddCotizacion(){this.cotizacion.push({cantidad:this.nuevaCotizacion.cantidad,UM:this.nuevaCotizacion.UM,nombreServicio:this.nuevaCotizacion.nombreServicio,subtotal:this.nuevaCotizacion.subtotal,precio:this.nuevaCotizacion.precio,valorimpuesto:this.nuevaCotizacion.valorimpuesto,importeImpuesto:this.nuevaCotizacion.importeImpuesto}),this.ClosedNewCotizacion()},ClosedNewCotizacion(){this.limpiarCotizacio(),this.newCotizacion=!1},limpiarCotizacio(){this.nuevaCotizacion.cantidad=0,this.nuevaCotizacion.UM="",this.nuevaCotizacion.nombreServicio="",this.nuevaCotizacion.precio=0,this.nuevaCotizacion.subtotal=0,this.nuevaCotizacion.valorimpuesto=0},async loadImpuesto(){await b.get("/impuestos/",{headers:{Authorization:`Bearer ${C.getUserLogged()}`}}).then(e=>{this.impuestos=e.data}).catch(e=>this.$q.notify({type:"negative",position:"top",message:e.response.data.message}))},selectCotizacion(e){this.nuevaCotizacion.cantidad=e.cantidad,this.nuevaCotizacion.UM=e.UM,this.nuevaCotizacion.nombreServicio=e.nombreServicio,this.nuevaCotizacion.precio=e.precio,this.nuevaCotizacion.valorimpuesto=0,this.confirmarEliminar=!0},Cancelar(){this.cotizacion.forEach((e,a)=>{e.nombreServicio===this.nuevaCotizacion.nombreServicio&&this.cotizacion.splice(a,1)}),this.confirmarEliminar=!1,this.limpiarCotizacio()},async savedPrefactura(){this.proyecto.id===""||this.cotizacion.length===0?this.$q.notify({type:"negative",position:"top",message:"Debe seleccionar un proyecto y al menos tener un servicio"}):await b.post("/factura/optional",{idProyecto:this.proyecto.id,prefacturas:this.cotizacion},{headers:{Authorization:`Bearer ${C.getUserLogged()}`}}).then(e=>{this.$q.notify({color:"positive",position:"top",message:"Se inserto La Prefactura "+e.data.consecutivoprefactura,icon:"done"}),this.$router.push({path:"/detailprefactura/"+e.data.id,params:{idfactura:e.data.id}})}).catch(e=>this.$q.notify({type:"negative",position:"top",message:e.response.data.message}))}},mounted(){this.loadProyecto(),this.loadServicio(),this.loadImpuesto()},setup(){return{filter:x("")}}},J={class:"q-pa-md flat bordered"},G=c("div",{class:"text-h6"},"Proyecto",-1),W={class:"q-pa-md q-gutter-sm"},X=c("div",{class:"text-h6"},"Nuevo Servicio",-1),Z={class:"q-pa-md"},$={class:"q-pa-md"},ee={class:"q-pa-md q-gutter-sm"},oe={class:"q-ml-sm"};function ie(e,a,p,r,l,s){return S(),I(M,null,[i(j,{class:"q-pa-md"},{default:t(()=>[c("div",J,[i(v,{class:"my-card"},{default:t(()=>[i(n,{class:"row items-center q-pb-none"},{default:t(()=>[G]),_:1}),i(n,null,{default:t(()=>[c("p",null," Nombre: "+u(l.proyecto.name),1),c("p",null," Cliente: "+u(l.proyecto.cliente),1),c("p",null," Fecha Inicio: "+u(s.FormatoFecha(l.proyecto.fecha_inicio)),1)]),_:1}),i(z),i(n,null,{default:t(()=>[i(U,{flat:"",bordered:"",title:"Servicios a Facturar",rows:l.cotizacion,columns:l.columscotizacion,color:"primary","row-key":"name",filter:r.filter},{body:t(o=>[i(k,{props:o,onClick:Q=>s.selectCotizacion(o.row)},{default:t(()=>[i(m,{key:"cantidad",props:o},{default:t(()=>[d(u(o.row.cantidad),1)]),_:2},1032,["props"]),i(m,{key:"UM",props:o},{default:t(()=>[d(u(o.row.UM),1)]),_:2},1032,["props"]),i(m,{key:"nombreServicio",props:o},{default:t(()=>[d(u(o.row.nombreServicio),1)]),_:2},1032,["props"]),i(m,{key:"precio",props:o},{default:t(()=>[d(u(o.row.precio),1)]),_:2},1032,["props"]),i(m,{key:"subtotal",props:o},{default:t(()=>[d(u(o.row.subtotal),1)]),_:2},1032,["props"]),i(m,{key:"importeimpuesto",props:o},{default:t(()=>[d(u(o.row.importeImpuesto),1)]),_:2},1032,["props"])]),_:2},1032,["props","onClick"])]),_:1},8,["rows","columns","filter"])]),_:1})]),_:1})]),i(D,{position:"top-right",offset:[18,18]},{default:t(()=>[w((S(),N(T,{icon:"add",direction:"down",color:"primary",disable:e.draggingFab},{default:t(()=>[i(_,{onClick:a[0]||(a[0]=o=>s.savedPrefactura()),color:"positive",icon:"save",disable:e.draggingFab},{default:t(()=>[i(V,null,{default:t(()=>[d(" Salvar ")]),_:1})]),_:1},8,["disable"]),i(_,{onClick:a[1]||(a[1]=o=>s.AbrirNuevaCotizacion()),color:"positive",icon:"add_box",disable:e.draggingFab},{default:t(()=>[i(V,null,{default:t(()=>[d(" Nuevo Servicio ")]),_:1})]),_:1},8,["disable"]),i(_,{onClick:a[2]||(a[2]=o=>s.OpenProyectos()),color:"positive",icon:"search",disable:e.draggingFab},{default:t(()=>[i(V,null,{default:t(()=>[d(" Buscar Proyecto ")]),_:1})]),_:1},8,["disable"])]),_:1},8,["disable"])),[[E,e.moveFab,void 0,{prevent:!0,mouse:!0}]])]),_:1}),c("template",null,[c("div",W,[i(y,{modelValue:l.newCotizacion,"onUpdate:modelValue":a[14]||(a[14]=o=>l.newCotizacion=o),persistent:""},{default:t(()=>[i(v,{class:"my-card",flat:"",bordered:""},{default:t(()=>[i(n,null,{default:t(()=>[X]),_:1}),i(z),i(n,{class:"horizontal"},{default:t(()=>[i(f,{filled:"",modelValue:l.nuevaCotizacion.cantidad,"onUpdate:modelValue":a[3]||(a[3]=o=>l.nuevaCotizacion.cantidad=o),label:"Cantidad",onKeyup:a[4]||(a[4]=o=>s.sumar()),mask:"#.##","fill-mask":"0","reverse-fill-mask":"","input-class":"text-right"},null,8,["modelValue"])]),_:1}),i(n,{class:"horizontal"},{default:t(()=>[i(g,{color:"primary",filled:"",modelValue:l.nuevaCotizacion.UM,"onUpdate:modelValue":a[5]||(a[5]=o=>l.nuevaCotizacion.UM=o),options:l.optionsUnidad,label:"Seleccione la Unidad"},{prepend:t(()=>[]),_:1},8,["modelValue","options"])]),_:1}),i(n,{class:"horizontal"},{default:t(()=>[i(g,{filled:"",modelValue:l.nuevaCotizacion.nombreServicio,"onUpdate:modelValue":a[6]||(a[6]=o=>l.nuevaCotizacion.nombreServicio=o),options:l.servicios,"option-value":o=>Object(o)===o&&"name"in o?o.name:null,"option-label":o=>Object(o)===o&&"name"in o?o.name:"- Servicio -","emit-value":"","map-options":""},null,8,["modelValue","options","option-value","option-label"])]),_:1}),i(n,{class:"horizontal"},{default:t(()=>[i(f,{filled:"",modelValue:l.nuevaCotizacion.precio,"onUpdate:modelValue":a[7]||(a[7]=o=>l.nuevaCotizacion.precio=o),label:"Precio Unitario *",onKeyup:a[8]||(a[8]=o=>s.sumar()),mask:"#.##","fill-mask":"0","reverse-fill-mask":"",prefix:"$","input-class":"text-right"},null,8,["modelValue"])]),_:1}),i(n,{class:"horizontal"},{default:t(()=>[i(g,{filled:"",modelValue:l.nuevaCotizacion.valorimpuesto,"onUpdate:modelValue":a[9]||(a[9]=o=>l.nuevaCotizacion.valorimpuesto=o),options:l.impuestos,"option-value":o=>Object(o)===o&&"valor"in o?o.valor:null,"option-label":o=>Object(o)===o&&"name"in o?o.name:"- Impuesto -","emit-value":"","map-options":"",change:s.sumar()},null,8,["modelValue","options","option-value","option-label","change"])]),_:1}),i(n,{class:"horizontal"},{default:t(()=>[i(f,{filled:"",readonly:!0,disable:!0,modelValue:l.nuevaCotizacion.subtotal,"onUpdate:modelValue":a[10]||(a[10]=o=>l.nuevaCotizacion.subtotal=o),label:"SubTotal *",prefix:"$","input-class":"text-right"},null,8,["modelValue"])]),_:1}),i(n,{class:"horizontal"},{default:t(()=>[i(f,{filled:"",readonly:!0,disable:!0,modelValue:l.nuevaCotizacion.importeImpuesto,"onUpdate:modelValue":a[11]||(a[11]=o=>l.nuevaCotizacion.importeImpuesto=o),label:"Impuesto *",prefix:"$","input-class":"text-right"},null,8,["modelValue"])]),_:1}),i(z),i(n,{class:"horizontal"},{default:t(()=>[i(q,null,{default:t(()=>[i(h,{label:"Enviar",icon:"send",type:"submit",color:"primary",flat:"",class:"q-ml-sm",onClick:a[12]||(a[12]=o=>s.AddCotizacion())}),i(h,{label:"Cancelar",icon:"cancel",type:"reset",color:"primary",flat:"",class:"q-ml-sm",onClick:a[13]||(a[13]=o=>s.ClosedNewCotizacion())})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])])])]),_:1}),c("div",Z,[i(y,{modelValue:l.findProy,"onUpdate:modelValue":a[16]||(a[16]=o=>l.findProy=o),"full-width":""},{default:t(()=>[i(v,{class:"my-card"},{default:t(()=>[i(n,null,{default:t(()=>[c("div",$,[i(U,{flat:"",bordered:"",title:"Proyectos",rows:l.proyectos,columns:l.columsproyecto,color:"primary","row-key":"name",filter:r.filter},{body:t(o=>[i(k,{props:o,onClick:Q=>s.selectProyecto(o.row)},{default:t(()=>[i(m,{key:"name",props:o},{default:t(()=>[d(u(o.row.name),1)]),_:2},1032,["props"]),i(m,{key:"cliente",props:o},{default:t(()=>[d(u(o.row.cliente.nombre),1)]),_:2},1032,["props"]),i(m,{key:"fecha_inicio",props:o},{default:t(()=>[d(u(s.FormatoFecha(o.row.fecha_inicio)),1)]),_:2},1032,["props"])]),_:2},1032,["props","onClick"])]),"top-right":t(()=>[i(f,{borderless:"",dense:"",debounce:"300",modelValue:r.filter,"onUpdate:modelValue":a[15]||(a[15]=o=>r.filter=o),placeholder:"Buscar"},{append:t(()=>[i(A,{name:"search"})]),_:1},8,["modelValue"])]),_:1},8,["rows","columns","filter"])])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),c("template",null,[c("div",ee,[i(y,{modelValue:l.confirmarEliminar,"onUpdate:modelValue":a[18]||(a[18]=o=>l.confirmarEliminar=o),persistent:""},{default:t(()=>[i(v,null,{default:t(()=>[i(n,{class:"row items-center"},{default:t(()=>[i(B,{icon:"priority_high",color:"primary","text-color":"white"}),c("span",oe,"Desea Quitar el servicio?: "+u(l.nuevaCotizacion.nombreServicio)+".",1)]),_:1}),i(q,{align:"right"},{default:t(()=>[w(i(h,{label:"NO",icon:"cancel",type:"cancel",color:"secondary",flat:"",class:"q-ml-sm"},null,512),[[O]]),i(h,{label:"Si",icon:"send",type:"submit",color:"primary",flat:"",class:"q-ml-sm",onClick:a[17]||(a[17]=o=>s.Cancelar())})]),_:1})]),_:1})]),_:1},8,["modelValue"])])])],64)}var ze=F(H,[["render",ie]]);export{ze as default};
