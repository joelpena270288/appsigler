import{Q as D,a as d,b as O}from"./QTable.54a77e6e.js";import{_ as Q,n as v,o as C,c as y,w as a,f as r,a as t,e as c,aw as n,L as H,ah as x,N as _,J as p,af as q,M as f,a$ as N,ax as w,Q as V}from"./index.ef228992.js";import{Q as T}from"./QInput.a2bee355.js";import{Q as A,a as k,b as S,c as L}from"./QPageSticky.a179ccb3.js";import{Q as E}from"./QCardActions.bed2bb53.js";import{Q as Y}from"./QPage.2fc420a1.js";import{T as R}from"./TouchPan.9047fff0.js";import{C as z}from"./ClosePopup.6197016b.js";import{api as g}from"./axios.23aa70c0.js";import{e as M}from"./export-file.dc78ba05.js";import{u as P}from"./use-quasar.38626e8f.js";import{a as b}from"./authenticate.bcdfbf4f.js";import{h as m}from"./moment.9709ab41.js";import{u as j}from"./index.403b85a6.js";import"./format.6bd9982d.js";import"./use-key-composition.25c6204a.js";import"./QItemLabel.1cc16253.js";import"./js.cookie.f93afda9.js";function F(e,s,u){let i=s!==void 0?s(e,u):e;return i=i==null?"":String(i),i=i.split('"').join('""'),`"${i}"`}const B=P(),G={name:"ConducePage",data(){return{showConduce:!1,consecutivo:"",idDelete:"",confirmarEliminar:!1,rows:[],columns:[{label:"No.",name:"consecutivo",required:!0,align:"center",field:e=>e.consecutivo,format:e=>`${e}`,sortable:!0},{label:"Estado",name:"estado",required:!1,align:"center",field:e=>e.status,format:e=>`${e}`,sortable:!0},{label:"Tipo",name:"name",required:!0,align:"center",field:e=>e.name,format:e=>`${e}`,sortable:!0},{label:"Proyecto",name:"proyecto.name",required:!1,align:"center",field:e=>e.proyecto.name,format:e=>`${e}`,sortable:!0},{label:"Nombre Empleado",name:"empleado.name",required:!1,align:"center",field:e=>e.empleado.name,format:e=>`${e}`,sortable:!0},{label:"Apellidos Empleado",name:"empleado.lastname",required:!1,align:"center",field:e=>e.empleado.lastname,format:e=>`${e}`,sortable:!0},{label:"Servicio",name:"servicio.name",required:!1,align:"center",field:e=>e.servicio.name,format:e=>`${e}`,sortable:!0},{label:"Equipo",name:"equipo.ficha",required:!1,align:"center",field:e=>e.equipo.ficha,format:e=>`${e}`,sortable:!0},{label:"Desde",name:"desde",required:!1,align:"center",field:e=>e.desde,format:e=>`${e}`,sortable:!0},{label:"Hasta",name:"hasta",required:!1,align:"center",field:e=>e.hasta,format:e=>`${e}`,sortable:!0},{label:"Fecha",name:"fecha",required:!1,align:"center",field:e=>e.fecha,format:e=>`${e}`,sortable:!0}],pdfmake:j(),selectedConduce:{consecutivo:"",tipo:"",proyecto:"",cliente:"",servicio:"",empleado:"",desde:"",hasta:"",horainicio:"",horafin:"",total_hora:0,cantidadviajes:0,material:"",firma_cliente:"",firma_empleado:"",equipo:"",metrosCubicos:"",fecha:"",observaciones:"",status:""},empresa:{}}},components:{},methods:{loadConduce(){g.get("/conduce/",{headers:{Authorization:`Bearer ${b.getUserLogged()}`}}).then(e=>{this.rows=e.data}).catch(e=>this.$q.notify({type:"negative",position:"top",message:e.response.data.message}))},onRowClick(e){var s;this.consecutivo=e.consecutivo,this.selectedConduce.consecutivo="",this.selectedConduce.tipo="",this.selectedConduce.proyecto="",this.selectedConduce.cliente="",this.selectedConduce.servicio="",this.selectedConduce.empleado="",this.selectedConduce.desde="",this.selectedConduce.hasta="",this.selectedConduce.horainicio="",this.selectedConduce.horafin="",this.selectedConduce.total_hora=0,this.selectedConduce.cantidadviajes=0,this.selectedConduce.material="",this.selectedConduce.firma_cliente="",this.selectedConduce.firma_empleado="",this.selectedConduce.observaciones="",this.selectedConduce.equipo="",this.selectedConduce.fecha="",this.selectedConduce.metrosCubicos=0,this.selectedConduce.status="",this.selectedConduce.consecutivo=e.consecutivo,this.selectedConduce.tipo=e.name,this.selectedConduce.proyecto=e.proyecto.name,this.selectedConduce.cliente=e.proyecto.cliente.nombre,this.selectedConduce.servicio=e.servicio.name,this.selectedConduce.empleado=e.empleado.name+" "+e.empleado.lastname,this.selectedConduce.desde=e.desde,this.selectedConduce.hasta=e.hasta,this.selectedConduce.horainicio=e.horaInicio,this.selectedConduce.horafin=e.horaFin,this.selectedConduce.total_hora=e.horas,this.selectedConduce.cantidadviajes=e.cantViajes,this.selectedConduce.material=(s=e.material)==null?void 0:s.name,this.selectedConduce.firma_cliente=e.firma_cliente,this.selectedConduce.firma_empleado=e.firma_chofer,this.selectedConduce.observaciones=e.observaciones,this.selectedConduce.equipo=e.equipo.modelo+" "+e.equipo.tipo.name+" "+e.equipo.ficha,this.selectedConduce.fecha=e.fecha,this.selectedConduce.metrosCubicos=e.metrosCubicos,this.selectedConduce.status=e.status,this.idDelete=e.id,this.showConduce=!0},Cancelar(){g.delete("/conduce/"+this.idDelete,{headers:{Authorization:`Bearer ${b.getUserLogged()}`}}).then(e=>{this.$q.notify({color:"positive",position:"top",message:"Se ha cancelado el conduce "+e.data.consecutivo,icon:"report_problem"}),this.confirmarEliminar=!1}).catch(e=>this.$q.notify({type:"negative",position:"top",message:e.response.data.message})),this.loadConduce(),this.showConduce=!1},OpenNewConduce(){this.$router.push("/newconduce")},FormatoFecha(e){return m(String(e)).format("MM/DD/YYYY hh:mm")},exportTable(){const e=[this.columns.map(u=>F(u.label))].concat(this.rows.map(u=>this.columns.map(i=>F(typeof i.field=="function"?i.field(u):u[i.field===void 0?i.name:i.field],i.format,u)).join(","))).join(`\r
`);M("Listado_Conduces.csv",e,"text/csv")!==!0&&B.notify({message:"Browser denied file download...",color:"negative",icon:"warning"})},onGenPDF(){let e="",s=[];switch(this.selectedConduce.tipo){case"ACARREO":{e="CONDUCE ACARREO",s=[{image:this.empresa.logo,fit:[60,60],style:"header"},{columns:[{width:100,text:"No.: "+this.selectedConduce.consecutivo},{width:"*",text:e,style:"header"},{width:"20%",text:"Fecha: "+m(this.selectedConduce.fecha).format("DD/MM/YYYY")}],columnGap:10},{text:"Cliente: "+this.selectedConduce.cliente,style:"left"},{columns:[{text:"Hora Salida: "+m(this.selectedConduce.horainicio).format("HH:mm"),style:"left"},{text:"Hora Llegada: "+m(this.selectedConduce.horafin).format("HH:mm"),style:"marginrightStyle"}]},{columns:[{text:"Desde: "+this.selectedConduce.desde,style:"left"},{text:"Hasta: "+this.selectedConduce.hasta,style:"marginrightStyle"}]},{text:"Equipo: "+this.selectedConduce.equipo,style:"left"},{text:"Observaciones: "+this.selectedConduce.observaciones,style:"left"},{text:"  ",style:"header"},{columns:[{image:this.selectedConduce.firma_cliente,fit:[100,100],style:"header"},{image:this.selectedConduce.firma_empleado,fit:[100,100],style:"header"}],columnGap:10},{columns:[{width:"*",text:"Firma Cliente",style:"centro"},{width:"*",text:"Firma Empleado",style:"centro"}],columnGap:10}];break}case"CONTROLHORA":{e="CONDUCE CONTROL HORA",s=[{image:this.empresa.logo,fit:[60,60],style:"header"},{columns:[{width:100,text:"No.: "+this.selectedConduce.consecutivo},{width:"*",text:e,style:"header"},{width:"20%",text:"Fecha: "+m(this.selectedConduce.fecha).format("DD/MM/YYYY")}],columnGap:10},{text:"Cliente: "+this.selectedConduce.cliente,style:"left"},{columns:[{text:"Hora Inicio: "+m(this.selectedConduce.horainicio).format("HH:mm"),style:"left"},{text:"Hora Fin: "+m(this.selectedConduce.horafin).format("HH:mm"),style:"marginrightStyle"}]},{columns:[{text:"Operador: "+this.selectedConduce.empleado,style:"left"},{text:"Obra: "+this.selectedConduce.proyecto,style:"marginrightStyle"}]},{text:"Equipo: "+this.selectedConduce.equipo,style:"left"},{text:"Servicio: "+this.selectedConduce.servicio,style:"left"},{text:"Observaciones: "+this.selectedConduce.observaciones,style:"left"},{text:"Cantidad Horas: "+this.selectedConduce.total_hora,style:"centro"},{text:"  ",style:"centro"},{columns:[{image:this.selectedConduce.firma_cliente,fit:[100,100],style:"header"},{image:this.selectedConduce.firma_empleado,fit:[100,100],style:"header"}],columnGap:10},{columns:[{width:"*",text:"Firma Cliente",style:"centro"},{width:"*",text:"Firma Empleado",style:"centro"}],columnGap:10}];break}case"CONTROLVIAJE":{e="CONDUCE CONTROL VIAJE",s=[{image:this.empresa.logo,fit:[60,60],style:"header"},{columns:[{width:100,text:"No.: "+this.selectedConduce.consecutivo},{width:"*",text:e,style:"header"},{width:"20%",text:"Fecha: "+m(this.selectedConduce.fecha).format("DD/MM/YYYY")}],columnGap:10},{text:"Cliente: "+this.selectedConduce.cliente,style:"left"},{columns:[{text:"Hora Inicio: "+m(this.selectedConduce.horainicio).format("HH:mm"),style:"left"},{text:"Hora Fin: "+m(this.selectedConduce.horafin).format("HH:mm"),style:"marginrightStyle"}]},{columns:[{text:"Chofer: "+this.selectedConduce.empleado,style:"left"},{text:"Obra: "+this.selectedConduce.proyecto,style:"marginrightStyle"}]},{columns:[{text:"Material: "+this.selectedConduce.material,style:"left"},{text:"Cantidad Viajes: "+this.selectedConduce.cantidadviajes,style:"marginrightStyle"}]},{columns:[{text:"Equipo: "+this.selectedConduce.equipo,style:"left"},{text:"Servicio: "+this.selectedConduce.servicio,style:"left"}]},{text:"Observaciones: "+this.selectedConduce.observaciones,style:"left"},{text:"Metros Cubicos: "+this.selectedConduce.metrosCubicos,style:"centro"},{text:"  ",style:"centro"},{columns:[{image:this.selectedConduce.firma_cliente,fit:[100,100],style:"header"},{image:this.selectedConduce.firma_empleado,fit:[100,100],style:"header"}],columnGap:10},{columns:[{width:"*",text:"Firma Cliente",style:"centro"},{width:"*",text:"Firma Empleado",style:"centro"}],columnGap:10}];break}}var u={info:{title:"Conduce",author:"Equipos Sigler",subject:"subject of document",keywords:"conduce, sigler"},pageSize:{width:395.28,height:"auto"},pageMargins:[15,15,15,15],content:s,styles:{header:{fontSize:18,bold:!0,alignment:"center"},centro:{fontSize:12,bold:!0,alignment:"center"},anotherStyle:{italics:!0,alignment:"left",fontSize:12},finTableStyle:{italics:!0,fontSize:12,alignment:"center",underline:!0},negritaStyle:{italics:!0,alignment:"left",fontSize:12,bold:!0},marginrightStyle:{italics:!0,alignment:"right",fontSize:12},marginrightBoldStyle:{italics:!0,alignment:"right",bold:!0}}};this.pdfmake.tableLayouts={exampleLayout:{hLineWidth:function(i,l){return i===0||i===l.table.body.length?0:i===l.table.headerRows?2:1},vLineWidth:function(i){return 0},hLineColor:function(i){return i===1?"black":"#aaa"},paddingLeft:function(i){return i===0?0:8},paddingRight:function(i,l){return i===l.table.widths.length-1?0:8}}},this.pdfmake.createPdf(u).download()},async loadEmpresa(){await g.get("/empresa",{headers:{Authorization:`Bearer ${b.getUserLogged()}`}}).then(e=>{this.empresa=e.data}).catch(e=>this.$q.notify({type:"negative",position:"top",message:e.response.data.message}))}},mounted(){this.loadConduce(),this.loadEmpresa()},setup(){return{confirm:v(!1),filter:v("")}}},I={class:"q-pa-md"},U={class:"q-pa-md q-gutter-sm"},$=r("div",{class:"text-h6"},"Conduce",-1),J={class:"q-pa-md q-gutter-sm"},W={class:"q-ml-sm"};function K(e,s,u,i,l,h){return C(),y(Y,{class:"q-pa-md"},{default:a(()=>[r("div",I,[t(O,{flat:"",bordered:"",title:"Conduces",rows:l.rows,columns:l.columns,color:"primary","row-key":"name",filter:i.filter},{body:a(o=>[t(D,{props:o,onClick:X=>h.onRowClick(o.row)},{default:a(()=>[t(d,{key:"consecutivo",props:o},{default:a(()=>[c(n(o.row.consecutivo),1)]),_:2},1032,["props"]),t(d,{key:"estado",props:o},{default:a(()=>[c(n(o.row.status),1)]),_:2},1032,["props"]),t(d,{key:"name",props:o},{default:a(()=>[c(n(o.row.name),1)]),_:2},1032,["props"]),t(d,{key:"proyecto.name",props:o},{default:a(()=>[c(n(o.row.proyecto.name),1)]),_:2},1032,["props"]),t(d,{key:"empleado.name",props:o},{default:a(()=>[c(n(o.row.empleado.name),1)]),_:2},1032,["props"]),t(d,{key:"empleado.lastname",props:o},{default:a(()=>[c(n(o.row.empleado.lastname),1)]),_:2},1032,["props"]),t(d,{key:"servicio.name",props:o},{default:a(()=>[c(n(o.row.servicio.name),1)]),_:2},1032,["props"]),t(d,{key:"equipo.ficha",props:o},{default:a(()=>[c(n(o.row.equipo.ficha),1)]),_:2},1032,["props"]),t(d,{key:"desde",props:o},{default:a(()=>[c(n(o.row.desde),1)]),_:2},1032,["props"]),t(d,{key:"hasta",props:o},{default:a(()=>[c(n(o.row.hasta),1)]),_:2},1032,["props"]),t(d,{key:"fecha",props:o},{default:a(()=>[c(n(h.FormatoFecha(o.row.fecha)),1)]),_:2},1032,["props"])]),_:2},1032,["props","onClick"])]),"top-right":a(()=>[t(T,{borderless:"",dense:"",debounce:"300",modelValue:i.filter,"onUpdate:modelValue":s[0]||(s[0]=o=>i.filter=o),placeholder:"Buscar"},{append:a(()=>[t(H,{name:"search"})]),_:1},8,["modelValue"])]),_:1},8,["rows","columns","filter"])]),t(L,{position:"top-right",offset:e.fabPos},{default:a(()=>[x((C(),y(A,{icon:"add",direction:"down",color:"primary",disable:e.draggingFab},{default:a(()=>[t(k,{onClick:s[1]||(s[1]=o=>h.exportTable()),color:"positive",icon:"download",disable:e.draggingFab},{default:a(()=>[t(S,null,{default:a(()=>[c(" Descargar ")]),_:1})]),_:1},8,["disable"]),t(k,{onClick:s[2]||(s[2]=o=>h.OpenNewConduce()),color:"positive",icon:"add_box",disable:e.draggingFab},{default:a(()=>[t(S,null,{default:a(()=>[c(" Nuevo ")]),_:1})]),_:1},8,["disable"])]),_:1},8,["disable"])),[[R,e.moveFab,void 0,{prevent:!0,mouse:!0}]])]),_:1},8,["offset"]),r("template",null,[r("div",U,[t(w,{modelValue:l.showConduce,"onUpdate:modelValue":s[6]||(s[6]=o=>l.showConduce=o),persistent:""},{default:a(()=>[t(_,{class:"my-card",flat:"",bordered:""},{default:a(()=>[t(p,null,{default:a(()=>[$]),_:1}),t(q),t(p,{class:"horizontal"},{default:a(()=>[r("p",null,"Consecutivo: "+n(l.selectedConduce.consecutivo),1),r("p",null," Tipo: "+n(l.selectedConduce.tipo),1),r("p",null," Servicio: "+n(l.selectedConduce.servicio),1),r("p",null,"Nombre Empleado: "+n(l.selectedConduce.empleado),1),r("p",null," Equipo: "+n(l.selectedConduce.equipo),1),r("p",null," Fecha: "+n(h.FormatoFecha(l.selectedConduce.fecha)),1)]),_:1}),t(q),t(p,{class:"horizontal"},{default:a(()=>[t(E,null,{default:a(()=>[t(f,{label:"Imprimir",icon:"print",type:"submit",color:"primary",flat:"",class:"q-ml-sm",onClick:s[3]||(s[3]=o=>h.onGenPDF())}),l.selectedConduce.status=="ABIERTO"?(C(),y(f,{key:0,label:"Eliminar",icon:"delete",type:"submit",color:"negative",flat:"",class:"q-ml-sm",onClick:s[4]||(s[4]=o=>l.confirmarEliminar=!0)})):N("",!0),t(f,{label:"Cerrar",icon:"cancel",type:"cancel",color:"primary",flat:"",class:"q-ml-sm",onClick:s[5]||(s[5]=o=>l.showConduce=!1)})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])])]),r("template",null,[r("div",J,[t(w,{modelValue:l.confirmarEliminar,"onUpdate:modelValue":s[8]||(s[8]=o=>l.confirmarEliminar=o),persistent:""},{default:a(()=>[t(_,null,{default:a(()=>[t(p,{class:"row items-center"},{default:a(()=>[t(V,{icon:"priority_high",color:"primary","text-color":"white"}),r("span",W,"Desea Cancelar El Conduce?: Consecutivo: "+n(l.consecutivo)+".",1)]),_:1}),t(E,{align:"right"},{default:a(()=>[x(t(f,{label:"NO",icon:"cancel",type:"cancel",color:"secondary",flat:"",class:"q-ml-sm"},null,512),[[z]]),t(f,{label:"Si",icon:"send",type:"submit",color:"primary",flat:"",class:"q-ml-sm",onClick:s[7]||(s[7]=o=>h.Cancelar())})]),_:1})]),_:1})]),_:1},8,["modelValue"])])])]),_:1})}var ye=Q(G,[["render",K]]);export{ye as default};
